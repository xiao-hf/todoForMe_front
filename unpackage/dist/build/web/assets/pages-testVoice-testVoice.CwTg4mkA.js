import{a1 as e,s as t,B as s,E as o,a2 as i,c as a,w as r,i as n,b as c,d as l,e as d,n as p,g as h,t as u,k as g,j as f}from"./index-DwnOT4K7.js";import{_ as R}from"./_plugin-vue_export-helper.BCo6x5W8.js";const _=R({name:"voice-recognition",data:()=>({isRecording:!1,isCancel:!1,startY:0,tipText:"按住说话",recorderManager:null,textTip:""}),created(){this.initRecorderManager()},onReady(){this.$nextTick((()=>{this.open()}))},methods:{initRecorderManager(){this.recorderManager=e(),this.recorderManager.onStart((()=>{console.log("recorder start")})),this.recorderManager.onError((e=>{console.error("录音错误：",e),t({title:"录音出错",icon:"none"}),this.resetRecordingState()})),this.recorderManager.onInterruptionBegin((()=>{console.log("录音被中断"),this.recorderManager.stop(),this.resetRecordingState()})),this.recorderManager.onInterruptionEnd((()=>{console.log("录音中断结束")})),this.recorderManager.onStop((e=>{console.log("录音结束",e),this.isCancel?this.resetRecordingState():this.handleRecordingFile(e.tempFilePath)}))},handleRecordingFile(e){s({filePath:e,success:s=>{s.size<1024||s.size>2097152?t({title:"录音文件大小异常",icon:"none"}):this.uploadVoiceFile(e)},fail:e=>{console.error("获取文件信息失败：",e),t({title:"文件读取失败",icon:"none"})},complete:()=>{this.resetRecordingState()}})},uploadVoiceFile(e){o({url:"https://5555api.com/data/api/fetchTextByVoice",filePath:e,name:"audio",formData:{},header:{apikey:"test_app_key_5555api"},success:e=>{try{const t=JSON.parse(e.data);console.log("上传成功，解析结果：",t),this.textTip=t.data&&t.data.partial||"未识别到内容"}catch(t){console.error("解析结果失败：",t),this.textTip="识别结果解析失败"}},fail:e=>{console.error("上传失败：",e),t({title:"上传失败",icon:"none"})}})},resetRecordingState(){this.isRecording=!1,this.tipText="按住说话"},open(){this.$refs.popup.open(),this.textTip=""},onPopupChange(e){e.show||(this.isRecording=!1,this.isCancel=!1,this.tipText="按住说话")},startRecord(e){console.error("按下了"),this.startY=e.touches[0].clientY,this.isRecording=!0,this.isCancel=!1,this.tipText="松开结束",this.recorderManager.start({duration:3e4,sampleRate:16e3,numberOfChannels:1,encodeBitRate:16e3,format:"wav"})},moveRecord(e){if(console.error("移动了"),!this.isRecording)return;this.startY-e.touches[0].clientY>100?(this.isCancel=!0,this.tipText="松开取消"):(this.isCancel=!1,this.tipText="松开结束")},endRecord(){console.error("抬起了",this.isRecording),this.isRecording&&(this.isRecording=!1,this.recorderManager.stop(),this.isCancel&&(this.tipText="已取消",setTimeout((()=>{this.$refs.popup.close()}),500)))}}},[["render",function(e,t,s,o,R,_){const m=g,T=n,x=f,C=i("uni-popup");return c(),a(T,{class:"voice-recognition"},{default:r((()=>[l(C,{ref:"popup",type:"bottom","background-color":"#fff","mask-click":!0,onChange:_.onPopupChange},{default:r((()=>[l(T,{class:"popup-content"},{default:r((()=>[l(T,{class:"header"},{default:r((()=>[l(m,{class:"title"},{default:r((()=>[d("语音识别")])),_:1}),l(m,{class:"subtitle"},{default:r((()=>[d("按住说话，上滑取消")])),_:1})])),_:1}),l(T,{class:"record-area"},{default:r((()=>[l(T,{class:p(["record-btn",{recording:R.isRecording,cancel:R.isCancel,pulse:R.isRecording}]),onTouchstart:_.startRecord,onTouchend:_.endRecord,onTouchmove:_.moveRecord},{default:r((()=>[l(T,{class:"btn-inner"},{default:r((()=>[l(T,{class:"mic-icon"},{default:r((()=>[l(x,{src:R.isRecording?"/static/icon_mic_fill.png":"/static/icon_mic_no.png",mode:"aspectFit"},null,8,["src"])])),_:1}),R.isRecording?(c(),a(T,{key:0,class:"ripple"})):h("",!0)])),_:1})])),_:1},8,["class","onTouchstart","onTouchend","onTouchmove"])])),_:1}),l(T,{class:"tip-area"},{default:r((()=>[l(m,{class:"tip-text"},{default:r((()=>[d(u(R.tipText),1)])),_:1}),R.isCancel?(c(),a(m,{key:0,class:"cancel-tip"},{default:r((()=>[d("松开手指，取消发送")])),_:1})):h("",!0)])),_:1}),R.textTip?(c(),a(T,{key:0,class:"result-area"},{default:r((()=>[l(T,{class:"result-title"},{default:r((()=>[d("识别结果")])),_:1}),l(T,{class:"result-content"},{default:r((()=>[d(u(R.textTip),1)])),_:1})])),_:1})):h("",!0)])),_:1})])),_:1},8,["onChange"])])),_:1})}],["__scopeId","data-v-21f870b1"]]);export{_ as default};

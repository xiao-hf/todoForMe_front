import{a8 as e,r as l,p as t,a9 as a,o as s,Q as o,a as n,c as i,w as c,i as u,b as r,g as d,d as g,e as m,t as f,n as p,u as _,v,F as I,f as h,J as y,A as k,s as w,y as C,z as x,G as $,R as b,j as D,k as O,S as P,M as T,I as S,l as z,x as F,C as R,aa as L}from"./index-DwnOT4K7.js";import{a as j,r as E,_ as M}from"./uni-app.es.BBfL1HZQ.js";import{u as N,t as A}from"./constants.CkXuN2aH.js";import{u as V}from"./user.H6OceLeH.js";import{b as q}from"./request.DtiC9qg0.js";import{_ as J}from"./_plugin-vue_export-helper.BCo6x5W8.js";const U=J({__name:"logDetail",setup(J){const U=V(),X=N(),H=e({id:"",name:"",code:""}),B=l([]),G=l(!1),Y=l(0),Q=l(!1),K=l(!1),W=l(!1),Z=l(!1),ee=l(!1),le=e({id:null,inDesc:"",inPrice:"",isRise:!0,count:"",existingImgs:[],addInImgs:[]}),te=e({id:null,tradeLogId:null,count:"",outPrice:"",outDesc:"",existingImgs:[],addOutImgs:[]}),ae=l(!1),se=l(!1),oe=l(!1),ne=l(null),ie=l([]),ce=l(!1),ue=t((()=>ie.value.reduce(((e,l)=>e+(l.count||0)),0))),re=t((()=>{const e=W.value,l=le.count,t=parseInt(le.count)||0,a=ue.value,s=e&&l&&a<t;return console.log("canAddOutLog 检查:",{isEditMode:e,logFormCount:l,inCount:t,totalOutCount:a,result:s}),s})),de=l({}),ge=l(0),me=l(0),fe=l(null),pe=t((()=>U.userInfo.backgroudImg||"")),_e=t((()=>Y.value>0?"+"+Y.value.toFixed(2):Y.value.toFixed(2))),ve=()=>{y()},Ie=()=>{le.id=null,le.inDesc="",le.inPrice="",le.isRise=!0,le.count="",le.existingImgs=[],le.addInImgs=[],ie.value=[],W.value=!1,Q.value=!0},he=()=>{K.value=!0,setTimeout((()=>{Q.value=!1,K.value=!1,ie.value=[]}),300)},ye=()=>{k({count:9,sizeType:["original","compressed"],sourceType:["album","camera"],success:e=>{console.log("选择入场图片成功:",e.tempFilePaths);const l=e.tempFilePaths.map(((e,l)=>({url:e,path:e,name:`inImg_${Date.now()}_${l}.jpg`,isExisting:!1})));le.addInImgs=[...le.addInImgs,...l],console.log("当前新增图片数组:",le.addInImgs)},fail:e=>{console.error("选择入场图片失败:",e)}})},ke=t((()=>le.inDesc.trim()&&le.inPrice&&(!0===le.isRise||!1===le.isRise)&&le.count)),we=async(e,l,t=!1)=>{try{if(t)return e;const a=await fetch(e),s=await a.blob();return new File([s],l,{type:s.type||"image/jpeg"})}catch(a){return console.error("创建文件对象失败:",a),null}},Ce=async()=>{if(!ke.value)return void w({title:"请填写必填项",icon:"none"});const e=parseFloat(le.count);if(isNaN(e)||e<=0)w({title:"请输入有效的手数",icon:"none"});else{C({title:W.value?"更新中...":"保存中..."});try{if(console.log("开始保存交易日志"),console.log("表单数据:",le),console.log("编辑模式:",W.value),console.log("goodsInfo.id:",H.id),W.value){if(!le.id)return x(),void w({title:"日志ID不能为空",icon:"error"})}else if(!H.id||""===H.id)return x(),void w({title:"商品ID不能为空，请重新进入页面",icon:"error",duration:3e3});const e={id:W.value?le.id:H.id,inDesc:le.inDesc.trim(),inPrice:parseFloat(le.inPrice),isRise:le.isRise,count:parseInt(le.count)};if(le.outDesc&&le.outDesc.trim()&&(e.outDesc=le.outDesc.trim()),le.outPrice&&""!==le.outPrice&&(e.outPrice=parseFloat(le.outPrice)),e.outImgs="",W.value&&le.existingImgs&&le.existingImgs.length>0){const l=le.existingImgs.map((e=>e.url));e.inImgs=JSON.stringify(l),console.log("已有入场图片JSON字符串:",e.inImgs)}else e.inImgs="";console.log("最终发送的数据:",e);const l=le.addInImgs&&le.addInImgs.length>0;console.log("是否有文件需要上传:",l);const t=W.value?`${q}/trade/updLog`:`${q}/trade/addLog`;let a;if(l){console.log("有文件，准备上传多个文件:",le.addInImgs.length,"张"),console.log("H5环境，使用fetch上传多文件");const l=new FormData;l.append("id",e.id.toString()),l.append("inDesc",e.inDesc),l.append("inPrice",e.inPrice.toString()),l.append("isRise",e.isRise.toString()),l.append("count",e.count.toString()),l.append("inImgs",e.inImgs||""),l.append("outDesc",e.outDesc||""),l.append("outImgs",e.outImgs||""),void 0!==e.outPrice&&l.append("outPrice",e.outPrice.toString());for(let e=0;e<le.addInImgs.length;e++){const t=le.addInImgs[e],a=await we(t.path||t.url,t.name||`inImg_${Date.now()}_${e}.jpg`,!1);a&&(l.append("addInImgs",a,a.name),console.log("添加文件到FormData (同名参数):",a.name,a.size,"bytes"))}console.log("FormData包含的字段:");for(let e of l.entries())console.log(e[0],e[1]instanceof File?`文件: ${e[1].name}`:e[1]);const s=await fetch(t,{method:"POST",headers:{Authorization:U.userInfo.authorization?`Bearer ${U.userInfo.authorization}`:""},body:l});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);a=await s.json(),console.log("H5上传结果:",a)}else console.log("无文件，使用普通请求"),a=await new Promise(((l,a)=>{$({url:t,method:"POST",data:e,header:{"Content-Type":"application/x-www-form-urlencoded",Authorization:U.userInfo.authorization?`Bearer ${U.userInfo.authorization}`:""},success:e=>{var t,s;console.log("请求结果:",e),200!==e.statusCode||200!==e.data.code&&"200"!==e.data.code?(console.error("请求失败:",e.data),a(new Error((null==(t=e.data)?void 0:t.msg)||(null==(s=e.data)?void 0:s.message)||"请求失败"))):l(e.data)},fail:e=>{console.error("请求失败:",e),a(e)}})}));x(),console.log("保存交易日志响应:",a),200===a.code||"200"===a.code?(w({title:W.value?"更新成功":"添加成功",icon:"success"}),he(),X.needRefreshGoods=Math.random(),le.id&&(Qe.value.delete(le.id),Ke.value.delete(le.id)),await Promise.all([$e(),xe()])):w({title:a.message||(W.value?"更新失败":"添加失败"),icon:"none"})}catch(l){x(),console.error("保存交易日志异常:",l),w({title:W.value?"更新失败":"添加失败",icon:"none"})}}},xe=async()=>{if(H.id)try{const e=await A.queryProfit({goodsId:H.id});200===e.code||"200"===e.code?Y.value=Number(e.data||0):console.error("获取商品盈亏数据失败:",e.message)}catch(e){console.error("获取商品盈亏数据异常:",e),Y.value=0}},$e=async()=>{var e;if(H.id)try{const l=await A.queryLog({goodsId:H.id,pageSize:50,pageNo:1});200===l.code||"200"===l.code?(B.value=(null==(e=l.data)?void 0:e.list)||[],be()):console.error("获取交易日志失败:",l.message)}catch(l){console.error("获取交易日志异常:",l)}},be=async()=>{for(const e of B.value)if(!Ke.value.has(e.id)){const l=await We(e);Ke.value.set(e.id,l)}},De=async e=>{if(e){ce.value=!0;try{const l=await A.queryOutLog(e);200===l.code||"200"===l.code?(ie.value=l.data||[],console.log("获取出场记录成功:",ie.value)):(console.error("获取出场记录失败:",l.message),ie.value=[])}catch(l){console.error("获取出场记录异常:",l),ie.value=[]}finally{ce.value=!1}}},Oe=async()=>{G.value=!0,Fe(),Qe.value.clear(),Ke.value.clear();try{await Promise.all([xe(),$e()])}catch(e){console.error("刷新失败:",e)}finally{setTimeout((()=>{G.value=!1}),1e3)}},Pe=e=>{if(!e)return"";const l=new Date(e);return`${String(l.getMonth()+1).padStart(2,"0")}-${String(l.getDate()).padStart(2,"0")} ${String(l.getHours()).padStart(2,"0")}:${String(l.getMinutes()).padStart(2,"0")}`},Te=e=>e?e>0?`+${e.toFixed(2)}`:e.toFixed(2):"0.00",Se=e=>e?e>0?"profit-positive":"profit-negative":"",ze=e=>{de.value[e]&&(de.value[e].translateX=0,de.value[e].showDelete=!1)},Fe=()=>{Object.keys(de.value).forEach((e=>{ze(e)}))},Re=async e=>{if(e){C({title:"删除中..."});try{const l=await A.delLog(e);x(),200===l.code||"200"===l.code?(w({title:"删除成功",icon:"success"}),X.needRefreshGoods=Math.random(),await Promise.all([$e(),xe()])):w({title:l.message||"删除失败",icon:"none"})}catch(l){x(),w({title:"删除失败",icon:"none"}),console.error("删除交易日志失败:",l)}}},Le=async e=>{if(e){C({title:"删除中..."});try{const l=await A.delOutLog(e);x(),200===l.code||"200"===l.code?(w({title:"删除成功",icon:"success"}),X.needRefreshGoods=Math.random(),await Promise.all([De(le.id),$e(),xe()])):w({title:l.message||"删除失败",icon:"none"})}catch(l){x(),w({title:"删除失败",icon:"none"}),console.error("删除平仓记录失败:",l)}}},je=(e,l)=>{L({urls:l,current:e,success:e=>{console.log("图片预览成功")},fail:e=>{console.error("图片预览失败:",e),w({title:"图片预览失败",icon:"none"})}})},Ee=()=>{const e=[];return le.existingImgs.forEach((l=>e.push(l.url))),le.addInImgs.forEach((l=>e.push(l.url))),e},Me=e=>{if(!e||"string"!=typeof e)return[];try{const l=JSON.parse(e);if(Array.isArray(l))return l}catch(l){console.error("解析出场图片URL失败:",l)}return[]},Ne=(e,l)=>{L({urls:l,current:e,success:e=>{console.log("出场图片预览成功")},fail:e=>{console.error("出场图片预览失败:",e),w({title:"出场图片预览失败",icon:"none"})}})},Ae=()=>{const e=parseInt(le.count)-ue.value;console.log("显示新增平仓记录弹窗"),console.log("入场手数:",le.count),console.log("已平仓手数:",ue.value),console.log("剩余未平仓手数:",e),te.id=null,te.tradeLogId=le.id,te.count="",te.outPrice="",te.outDesc="",te.existingImgs=[],te.addOutImgs=[],ae.value=!1,Z.value=!0},Ve=()=>{ee.value=!0,setTimeout((()=>{Z.value=!1,ee.value=!1,ae.value=!1,te.id=null}),300)},qe=t((()=>{const e=parseInt(te.count)||0,l=parseFloat(te.outPrice)||0;if(e<=0||l<=0)return!1;if(ae.value)return!0;return e<=parseInt(le.count)-ue.value})),Je=()=>{k({count:9,sizeType:["original","compressed"],sourceType:["album","camera"],success:e=>{console.log("选择出场图片成功:",e.tempFilePaths);const l=e.tempFilePaths.map(((e,l)=>({url:e,path:e,name:`outImg_${Date.now()}_${l}.jpg`,isExisting:!1})));te.addOutImgs=[...te.addOutImgs,...l],console.log("当前新增出场图片数组:",te.addOutImgs)},fail:e=>{console.error("选择出场图片失败:",e)}})},Ue=()=>{const e=[];return te.existingImgs.forEach((l=>e.push(l.url))),te.addOutImgs.forEach((l=>e.push(l.url))),e},Xe=async()=>{if(!qe.value)return void w({title:"请填写必填项",icon:"none"});const e=parseInt(te.count)||0;if(ae.value){if(e<=0)return void w({title:"手数必须大于0",icon:"none"})}else{const l=parseInt(le.count)-ue.value;if(e<=0||e>l)return void w({title:`平仓手数必须在1-${l}之间`,icon:"none"})}C({title:"保存中..."});try{console.log("开始保存平仓记录"),console.log("表单数据:",te);const l={count:e,outPrice:parseFloat(te.outPrice),outDesc:te.outDesc.trim()||""};if(ae.value?l.tradeLogOutId=te.id:l.tradeLogId=te.tradeLogId,te.addOutImgs&&te.addOutImgs.length>0){console.log("处理新增出场图片:",te.addOutImgs.length,"张");const e=[];for(let l=0;l<te.addOutImgs.length;l++){const t=te.addOutImgs[l],a=t.name||`outImg_${Date.now()}_${l}.jpg`,s=await we(t.path||t.url,a,!1);s?(e.push(s),console.log("成功创建新增出场图片文件对象:",a,s.size,"bytes")):console.warn("跳过无法转换的新增出场图片:",t.path||t.url)}e.length>0&&(l.addOutImgs=e,console.log("新上传的出场图片文件对象数组:",l.addOutImgs))}if(ae.value&&te.existingImgs&&te.existingImgs.length>0){const e=te.existingImgs.map((e=>e.url));l.outImgs=JSON.stringify(e),console.log("已有出场图片JSON字符串:",l.outImgs)}else ae.value&&(l.outImgs=JSON.stringify([]),console.log("已有出场图片为空，传递空数组JSON字符串"));console.log("最终发送的平仓数据:",l);const t=te.addOutImgs&&te.addOutImgs.length>0||l.hasOutImgs;console.log("是否有文件需要上传:",t);const a=ae.value?`${q}/trade/updOutLog`:`${q}/trade/addOutLog`;let s;if(t){console.log("有文件，准备上传多个出场图片:",te.addOutImgs.length,"张"),console.log("H5环境，使用fetch上传多个出场图片");const e=new FormData;l.tradeLogId&&e.append("tradeLogId",l.tradeLogId.toString()),l.tradeLogOutId&&e.append("tradeLogOutId",l.tradeLogOutId.toString()),e.append("count",l.count.toString()),e.append("outPrice",l.outPrice.toString()),e.append("outDesc",l.outDesc||""),e.append("outImgs",l.outImgs||"");for(let a=0;a<l.addOutImgs.length;a++){const t=l.addOutImgs[a];e.append("addOutImgs",t,t.name),console.log("添加出场图片到FormData (同名参数):",t.name,t.size,"bytes")}console.log("FormData包含的字段:");for(let l of e.entries())console.log(l[0],l[1]instanceof File?`文件: ${l[1].name}`:l[1]);const t=await fetch(a,{method:"POST",headers:{Authorization:U.userInfo.authorization?`Bearer ${U.userInfo.authorization}`:""},body:e});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);s=await t.json(),console.log("H5出场图片上传结果:",s)}else console.log("无文件，使用普通请求"),s=await new Promise(((e,t)=>{$({url:a,method:"POST",data:l,header:{"Content-Type":"application/x-www-form-urlencoded",Authorization:U.userInfo.authorization?`Bearer ${U.userInfo.authorization}`:""},success:l=>{var a,s;console.log("请求结果:",l),200!==l.statusCode||200!==l.data.code&&"200"!==l.data.code?(console.error("请求失败:",l.data),t(new Error((null==(a=l.data)?void 0:a.msg)||(null==(s=l.data)?void 0:s.message)||"请求失败"))):e(l.data)},fail:e=>{console.error("请求失败:",e),t(e)}})}));x(),console.log("保存平仓记录响应:",s),200===s.code||"200"===s.code?(w({title:ae.value?"平仓记录更新成功":"平仓记录添加成功",icon:"success"}),Ve(),X.needRefreshGoods=Math.random(),await Promise.all([De(le.id),$e(),xe()])):w({title:s.message||(ae.value?"平仓记录更新失败":"平仓记录添加失败"),icon:"none"})}catch(l){x(),console.error("保存平仓记录异常:",l),w({title:"平仓记录添加失败",icon:"none"})}};j((e=>{console.log("页面参数:",e),H.id=e.goodsId||"",H.name=decodeURIComponent(e.goodsName||""),H.code=decodeURIComponent(e.goodsCode||""),console.log("解析后的商品信息:",H),a({title:H.name||"交易日志"})})),s((()=>{U.initUserInfo(),Promise.all([xe(),$e()])}));const He=e=>{const l=te.count,t=parseInt(le.count)-ue.value;if(console.log("失焦检查 - 当前值:",l,"最大值:",t),!l||""===l)return;const a=parseInt(l);isNaN(a)||a<=0?te.count="":a>t&&t>0&&(console.log("失焦时超过最大值，强制设置为:",t),te.count=t.toString(),b((()=>{w({title:`已自动调整为最大可平仓手数${t}手`,icon:"none",duration:2e3})})))};o((()=>te.count),(e=>{if(!e||""===e)return;const l=parseInt(le.count)-ue.value,t=parseInt(e);console.log("实时监听 - 新值:",e,"最大值:",l),t>l&&l>0&&setTimeout((()=>{parseInt(te.count)>l&&(console.log("实时检测超过最大值，调整为:",l),te.count=l.toString(),w({title:`最多只能平仓${l}手`,icon:"none",duration:1500}))}),500)}),{immediate:!1});const Be=()=>{oe.value=!0,setTimeout((()=>{se.value=!1,oe.value=!1,ne.value=null}),300)},Ge=e=>{if(!e)return[];if(Array.isArray(e))return e;if("string"==typeof e)try{const l=JSON.parse(e);if(Array.isArray(l))return l}catch(l){console.error("解析入场图片URL失败:",l);const t=/https?:\/\/[^\s"',\]]+/g;return(e.match(t)||[]).map((e=>e.replace(/[,\]"']+$/,"")))}return[]},Ye=(e,l=[])=>(e.count||0)-l.reduce(((e,l)=>e+(l.count||0)),0),Qe=l(new Map),Ke=l(new Map),We=async e=>{let l=Qe.value.get(e.id);l||(l=await(async e=>{try{const l=await A.queryOutLog(e);if(200===l.code||"200"===l.code)return l.data||[]}catch(l){console.error("获取出场记录失败:",l)}return[]})(e.id),Qe.value.set(e.id,l));const t=Ye(e,l),a=((e,l=[])=>{let t;"number"==typeof e.createTime||e.createTime,t=new Date(e.createTime);const a=Ye(e,l);let s;if(console.log(`[持仓时间计算] 日志ID: ${e.id}, 入场时间: ${e.createTime} -> ${t}, 未平手数: ${a}`),a>0||0===l.length)s=new Date,console.log(`[持仓时间计算] 使用当前时间: ${s}`);else{const e=[];if(l.forEach(((l,t)=>{let a;"number"==typeof l.createTime||l.createTime,a=new Date(l.createTime),console.log(`[持仓时间计算] 出场记录${t+1}: ${l.createTime} -> ${a}`),isNaN(a.getTime())||e.push(a.getTime())})),e.length>0){const l=Math.max(...e);s=new Date(l),console.log(`[持仓时间计算] 使用最晚平仓时间: ${s}`)}else s=new Date,console.log(`[持仓时间计算] 无有效出场时间，使用当前时间: ${s}`)}const o=s.getTime()-t.getTime();if(o<0){console.warn(`[持仓时间计算] 时间差为负数: ${o}ms，使用绝对值`);const e=Math.abs(o);return{hours:Math.floor(e/36e5),minutes:Math.floor(e%36e5/6e4),isOpen:a>0}}const n=Math.floor(o/36e5),i=Math.floor(o%36e5/6e4);return console.log(`[持仓时间计算] 时间差: ${o}ms -> ${n}h${i}m`),{hours:n,minutes:i,isOpen:a>0}})(e,l);return{entryPrice:e.inPrice||0,totalCount:e.count||0,unClosedCount:t,holdingTime:(s=a,`${s.hours}h${s.minutes}m`),isOpen:a.isOpen};var s};return(e,l)=>{const t=D,a=E(n("uni-icons"),M),s=u,o=O,y=P,k=T,w=S,C=z;return r(),i(s,{class:"log-detail-container"},{default:c((()=>[pe.value?(r(),i(t,{key:0,src:pe.value,class:"background-image",mode:"aspectFill"},null,8,["src"])):d("",!0),g(s,{class:"nav-header"},{default:c((()=>[g(s,{class:"nav-left"},{default:c((()=>[g(s,{class:"icon-wrapper",onClick:ve},{default:c((()=>[g(a,{type:"back",size:"24",color:"#fff"})])),_:1})])),_:1}),g(s,{class:"nav-center"},{default:c((()=>[g(o,{class:"profit-text"},{default:c((()=>[m(f(H.code)+" 盈亏: ",1),g(o,{class:p(["profit-number",{"profit-positive":Y.value>0,"profit-negative":Y.value<0}])},{default:c((()=>[m(f(_e.value),1)])),_:1},8,["class"])])),_:1})])),_:1}),g(s,{class:"nav-right"})])),_:1}),g(s,{class:"log-content"},{default:c((()=>[g(y,{class:"logs-list","scroll-y":"true","refresher-enabled":"true","refresher-background":"transparent","refresher-triggered":G.value,onRefresherrefresh:Oe},{default:c((()=>[B.value.length>0?(r(),i(s,{key:0,class:"logs-container"},{default:c((()=>[(r(!0),_(I,null,v(B.value,((e,l)=>(r(),i(s,{class:"log-swipe-container",key:e.id},{default:c((()=>[g(s,{class:"log-swipe-wrapper"},{default:c((()=>{var l,t;return[g(s,{class:"log-item",style:F({transform:`translateX(${(null==(l=de.value[e.id])?void 0:l.translateX)||0}rpx)`}),onTouchstart:l=>{return t=l,a=e.id,ge.value=t.touches[0].clientX,me.value=t.touches[0].clientY,void(fe.value=a);var t,a},onTouchmove:l=>((e,l)=>{if(fe.value!==l)return;const t=e.touches[0].clientX,a=e.touches[0].clientY,s=t-ge.value,o=a-me.value;if(!(Math.abs(o)>Math.abs(s))&&s<0){const e=Math.max(.5*s,-120);de.value[l]||(de.value[l]={}),de.value[l].translateX=e,de.value[l].showDelete=e<-30}})(l,e.id),onTouchend:l=>((e,l)=>{if(fe.value!==l)return;const t=de.value[l];t&&(t.translateX<-60||t.translateX<-30?(t.translateX=-120,t.showDelete=!0):ze(l),fe.value=null)})(0,e.id),onClick:l=>(e=>{console.log("查看日志详情:",e),ne.value={...e},De(e.id),se.value=!0})(e)},{default:c((()=>[g(s,{class:"log-row"},{default:c((()=>[g(s,{class:"log-date-col"},{default:c((()=>[g(o,{class:"log-date"},{default:c((()=>[m(f(Pe(e.createTime)),1)])),_:2},1024)])),_:2},1024),g(s,{class:"log-info-col"},{default:c((()=>[Ke.value.get(e.id)?(r(),i(s,{key:0,class:"log-summary"},{default:c((()=>[g(s,{class:"summary-row"},{default:c((()=>[g(o,{class:"summary-item"},{default:c((()=>[m("开仓: $"+f(Ke.value.get(e.id).entryPrice),1)])),_:2},1024),g(o,{class:"summary-item"},{default:c((()=>[m("手数: "+f(Ke.value.get(e.id).totalCount),1)])),_:2},1024),g(o,{class:p(["direction-tag",e.isRise?"direction-long":"direction-short"])},{default:c((()=>[m(f(e.isRise?"多":"空"),1)])),_:2},1032,["class"])])),_:2},1024),g(s,{class:"summary-row"},{default:c((()=>[g(o,{class:p(["summary-item",{"unclosed-text":Ke.value.get(e.id).isOpen}])},{default:c((()=>[m(" 未平: "+f(Ke.value.get(e.id).unClosedCount)+"手 ",1)])),_:2},1032,["class"]),g(o,{class:p(["summary-item",{"holding-open":Ke.value.get(e.id).isOpen}])},{default:c((()=>[m(" 持仓: "+f(Ke.value.get(e.id).holdingTime),1)])),_:2},1032,["class"])])),_:2},1024)])),_:2},1024)):(r(),i(s,{key:1,class:"log-summary loading"},{default:c((()=>[g(o,{class:"loading-text"},{default:c((()=>[m("加载中...")])),_:1})])),_:1}))])),_:2},1024),g(s,{class:"log-profit-col"},{default:c((()=>[g(o,{class:p(["log-profit",Se(e.profit)])},{default:c((()=>[m(f(Te(e.profit)),1)])),_:2},1032,["class"])])),_:2},1024),g(s,{class:"edit-icon",onClick:h((l=>(e=>{if(console.log("编辑交易日志，log.inImgs:",e.inImgs),le.id=e.id,le.inDesc=e.inDesc||"",le.inPrice=e.inPrice||"",le.isRise=e.isRise,le.count=e.count||"",e.inImgs&&Array.isArray(e.inImgs)&&e.inImgs.length>0)le.existingImgs=e.inImgs.map(((l,t)=>({url:l,path:l,name:`existingImg_${e.id}_${t}.jpg`,isExisting:!0})));else if(e.inImgs&&"string"==typeof e.inImgs)try{const l=JSON.parse(e.inImgs);Array.isArray(l)?le.existingImgs=l.map(((l,t)=>({url:l,path:l,name:`existingImg_${e.id}_${t}.jpg`,isExisting:!0}))):le.existingImgs=[]}catch(l){const t=/https?:\/\/[^\s"',\]]+/g,a=e.inImgs.match(t)||[];le.existingImgs=a.map(((l,t)=>{const a=l.replace(/[,\]"']+$/,"");return{url:a,path:a,name:`existingImg_${e.id}_${t}.jpg`,isExisting:!0}}))}else le.existingImgs=[];le.addInImgs=[],console.log("处理后的已有图片数组:",le.existingImgs),De(e.id),W.value=!0,Q.value=!0})(e)),["stop"])},{default:c((()=>[g(a,{type:"compose",size:"22",color:"#667eea"})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1032,["style","onTouchstart","onTouchmove","onTouchend","onClick"]),(null==(t=de.value[e.id])?void 0:t.showDelete)?(r(),i(s,{key:0,class:"delete-action",onClick:l=>(e=>{Fe(),R({title:"删除确认",content:"确定要删除这条交易记录吗？",confirmColor:"#f56c6c",success:async l=>{l.confirm&&await Re(e.id)}})})(e)},{default:c((()=>[g(a,{type:"trash",size:"24",color:"#fff"})])),_:2},1032,["onClick"])):d("",!0)]})),_:2},1024)])),_:2},1024)))),128))])),_:1})):(r(),i(s,{key:1,class:"empty-state"},{default:c((()=>[g(o,{class:"empty-text"},{default:c((()=>[m("暂无交易记录")])),_:1}),g(o,{class:"empty-tips"},{default:c((()=>[m('点击下方按钮"+"添加交易记录')])),_:1})])),_:1}))])),_:1},8,["refresher-triggered"])])),_:1}),g(s,{class:"add-log-container"},{default:c((()=>[g(s,{class:"add-log-btn",onClick:Ie},{default:c((()=>[g(a,{type:"plus",size:"20",color:"#fff"}),g(o,{class:"add-btn-text"},{default:c((()=>[m("添加交易记录")])),_:1})])),_:1})])),_:1}),Q.value?(r(),i(s,{key:1,class:"modal-overlay",onClick:he},{default:c((()=>[g(s,{class:p(["modal-content log-modal",{closing:K.value}]),onClick:l[5]||(l[5]=h((()=>{}),["stop"]))},{default:c((()=>[g(s,{class:"popup-header"},{default:c((()=>[g(o,{class:"popup-title"},{default:c((()=>[m(f(W.value?"编辑交易日志":"添加交易日志"),1)])),_:1}),g(s,{class:"popup-close",onClick:he},{default:c((()=>[g(a,{type:"close",size:"20",color:"#666"})])),_:1})])),_:1}),g(y,{class:"form-content","scroll-y":"true"},{default:c((()=>[g(s,{class:"input-group"},{default:c((()=>[g(s,{class:"input-label"},{default:c((()=>[g(o,{class:"required"},{default:c((()=>[m("*")])),_:1}),m("入场描述 ")])),_:1}),g(k,{class:"log-textarea",modelValue:le.inDesc,"onUpdate:modelValue":l[0]||(l[0]=e=>le.inDesc=e),placeholder:"请输入入场描述",maxlength:"500","auto-height":""},null,8,["modelValue"])])),_:1}),g(s,{class:"input-group"},{default:c((()=>[g(s,{class:"input-label"},{default:c((()=>[g(o,{class:"required"},{default:c((()=>[m("*")])),_:1}),m("入场价格 ")])),_:1}),g(w,{class:"log-input",type:"digit",modelValue:le.inPrice,"onUpdate:modelValue":l[1]||(l[1]=e=>le.inPrice=e),placeholder:"请输入入场价格"},null,8,["modelValue"])])),_:1}),g(s,{class:"input-group"},{default:c((()=>[g(s,{class:"input-label"},{default:c((()=>[g(o,{class:"required"},{default:c((()=>[m("*")])),_:1}),m("交易方向 ")])),_:1}),g(s,{class:"radio-group"},{default:c((()=>[g(s,{class:"radio-item",onClick:l[2]||(l[2]=e=>le.isRise=!0)},{default:c((()=>[g(s,{class:p(["radio",{checked:!0===le.isRise}])},{default:c((()=>[!0===le.isRise?(r(),i(s,{key:0,class:"radio-inner"})):d("",!0)])),_:1},8,["class"]),g(o,{class:"radio-text"},{default:c((()=>[m("做多(看涨)")])),_:1})])),_:1}),g(s,{class:"radio-item",onClick:l[3]||(l[3]=e=>le.isRise=!1)},{default:c((()=>[g(s,{class:p(["radio",{checked:!1===le.isRise}])},{default:c((()=>[!1===le.isRise?(r(),i(s,{key:0,class:"radio-inner"})):d("",!0)])),_:1},8,["class"]),g(o,{class:"radio-text"},{default:c((()=>[m("做空(看跌)")])),_:1})])),_:1})])),_:1})])),_:1}),g(s,{class:"input-group"},{default:c((()=>[g(s,{class:"input-label"},{default:c((()=>[g(o,{class:"required"},{default:c((()=>[m("*")])),_:1}),m("手数 ")])),_:1}),g(w,{class:"log-input",type:"digit",modelValue:le.count,"onUpdate:modelValue":l[4]||(l[4]=e=>le.count=e),placeholder:"请输入手数"},null,8,["modelValue"])])),_:1}),g(s,{class:"input-group"},{default:c((()=>[g(s,{class:"input-label"},{default:c((()=>[m("入场依据")])),_:1}),g(s,{class:"image-upload"},{default:c((()=>[g(s,{class:"image-grid"},{default:c((()=>[g(s,{class:"upload-btn",onClick:ye},{default:c((()=>[g(a,{type:"plus",size:"30",color:"#667eea"})])),_:1}),(r(!0),_(I,null,v(le.existingImgs,((e,l)=>(r(),i(s,{class:"image-item",key:"existing-"+l},{default:c((()=>[g(t,{src:e.url,class:"preview-image",mode:"aspectFill",onClick:l=>je(e.url,Ee()),onError:t=>((e,l)=>{console.error(`图片加载失败: ${e}, 索引: ${l}`)})(e.url,l),onLoad:t=>((e,l)=>{console.log(`图片加载成功: ${e}, 索引: ${l}`)})(e.url,l)},null,8,["src","onClick","onError","onLoad"]),g(s,{class:"delete-image",onClick:h((e=>(e=>{le.existingImgs.splice(e,1)})(l)),["stop"])},{default:c((()=>[g(a,{type:"close",size:"16",color:"#fff"})])),_:2},1032,["onClick"])])),_:2},1024)))),128)),(r(!0),_(I,null,v(le.addInImgs,((e,l)=>(r(),i(s,{class:"image-item",key:"new-"+l},{default:c((()=>[g(t,{src:e.url,class:"preview-image",mode:"aspectFill",onClick:l=>je(e.url,Ee())},null,8,["src","onClick"]),g(s,{class:"delete-image",onClick:h((e=>(e=>{le.addInImgs.splice(e,1)})(l)),["stop"])},{default:c((()=>[g(a,{type:"close",size:"16",color:"#fff"})])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1}),W.value&&ie.value.length>0?(r(),i(s,{key:0,class:"out-logs-section"},{default:c((()=>[g(s,{class:"section-title"},{default:c((()=>[m("平仓记录")])),_:1}),g(s,{class:"out-logs-list"},{default:c((()=>[(r(!0),_(I,null,v(ie.value,((e,l)=>(r(),i(s,{class:"out-log-item",key:e.id},{default:c((()=>[g(s,{class:"out-log-header"},{default:c((()=>[g(o,{class:"out-log-date"},{default:c((()=>[m(f(Pe(e.createTime)),1)])),_:2},1024),g(s,{class:"out-log-right"},{default:c((()=>[g(o,{class:p(["out-log-profit",Se(e.profit)])},{default:c((()=>[m(f(Te(e.profit)),1)])),_:2},1032,["class"]),g(s,{class:"out-edit-icon",onClick:h((l=>(e=>{if(console.log("编辑出场记录:",e),ae.value=!0,te.id=e.id,te.tradeLogId=e.tradeLogId,te.count=e.count.toString(),te.outPrice=e.outPrice?e.outPrice.toString():"",te.outDesc=e.outDesc||"",e.outImgs)try{const l=JSON.parse(e.outImgs);Array.isArray(l)?te.existingImgs=l.map(((l,t)=>({url:l,path:l,name:`existingOutImg_${e.id}_${t}.jpg`,isExisting:!0}))):te.existingImgs=[]}catch(l){console.error("解析出场图片失败:",l),te.existingImgs=[]}else te.existingImgs=[];te.addOutImgs=[],Z.value=!0})(e)),["stop"])},{default:c((()=>[g(a,{type:"compose",size:"20",color:"#667eea"})])),_:2},1032,["onClick"]),g(s,{class:"out-delete-icon",onClick:h((l=>(e=>{R({title:"删除确认",content:"确定要删除这条平仓记录吗？",confirmColor:"#f56c6c",success:async l=>{l.confirm&&await Le(e.id)}})})(e)),["stop"])},{default:c((()=>[g(a,{type:"trash",size:"20",color:"#f56c6c"})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024),g(s,{class:"out-log-content"},{default:c((()=>[g(s,{class:"out-log-info"},{default:c((()=>[g(o,{class:"out-count"},{default:c((()=>[m("手数: "+f(e.count),1)])),_:2},1024)])),_:2},1024),e.outDesc?(r(),i(s,{key:0,class:"out-log-desc"},{default:c((()=>[g(o,{class:"desc-text"},{default:c((()=>[m(f(e.outDesc),1)])),_:2},1024)])),_:2},1024)):d("",!0),e.outImgs?(r(),i(s,{key:1,class:"out-log-images"},{default:c((()=>[g(s,{class:"out-images-grid"},{default:c((()=>[(r(!0),_(I,null,v(Me(e.outImgs),((l,a)=>(r(),i(s,{class:"out-image-item",key:a},{default:c((()=>[g(t,{src:l,class:"out-preview-image",mode:"aspectFill",onClick:t=>Ne(l,Me(e.outImgs))},null,8,["src","onClick"])])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024)):d("",!0)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})):d("",!0),re.value?(r(),i(s,{key:1,class:"add-out-log-section"},{default:c((()=>[g(s,{class:"add-out-log-item"},{default:c((()=>[g(s,{class:"add-out-content"},{default:c((()=>[g(s,{class:"remaining-info"},{default:c((()=>[g(o,{class:"remaining-label"},{default:c((()=>[m("剩余未平仓:")])),_:1}),g(o,{class:"remaining-count"},{default:c((()=>[m(f(parseInt(le.count)-ue.value)+" 手",1)])),_:1})])),_:1}),g(C,{class:"inline-add-btn",onClick:Ae},{default:c((()=>[g(o,{class:"btn-text"},{default:c((()=>[m("新增平仓")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):d("",!0)])),_:1}),g(s,{class:"popup-actions"},{default:c((()=>[g(C,{class:"cancel-btn",onClick:he},{default:c((()=>[m("取消")])),_:1}),g(C,{class:"confirm-btn",onClick:Ce,disabled:!ke.value},{default:c((()=>[m(f(W.value?"更新":"保存"),1)])),_:1},8,["disabled"])])),_:1})])),_:1},8,["class"])])),_:1})):d("",!0),Z.value?(r(),i(s,{key:2,class:"modal-overlay",onClick:Ve},{default:c((()=>[g(s,{class:p(["modal-content out-log-modal",{closing:ee.value}]),onClick:l[9]||(l[9]=h((()=>{}),["stop"]))},{default:c((()=>[g(s,{class:"popup-header"},{default:c((()=>[g(o,{class:"popup-title"},{default:c((()=>[m(f(ae.value?"编辑平仓记录":"新增平仓记录"),1)])),_:1}),g(s,{class:"popup-close",onClick:Ve},{default:c((()=>[g(a,{type:"close",size:"20",color:"#666"})])),_:1})])),_:1}),g(y,{class:"form-content","scroll-y":"true"},{default:c((()=>[g(s,{class:"input-group"},{default:c((()=>[g(s,{class:"input-label"},{default:c((()=>[g(o,{class:"required"},{default:c((()=>[m("*")])),_:1}),m("平仓手数 ")])),_:1}),g(w,{class:"log-input",type:"digit",modelValue:te.count,"onUpdate:modelValue":l[6]||(l[6]=e=>te.count=e),onBlur:He,placeholder:`最多可平仓 ${parseInt(le.count)-ue.value} 手`},null,8,["modelValue","placeholder"]),g(s,{class:"input-hint"},{default:c((()=>[g(o,{class:"hint-text"},{default:c((()=>[m("剩余未平仓: "+f(parseInt(le.count)-ue.value)+" 手",1)])),_:1})])),_:1})])),_:1}),g(s,{class:"input-group"},{default:c((()=>[g(s,{class:"input-label"},{default:c((()=>[g(o,{class:"required"},{default:c((()=>[m("*")])),_:1}),m("出场价格 ")])),_:1}),g(w,{class:"log-input",type:"digit",modelValue:te.outPrice,"onUpdate:modelValue":l[7]||(l[7]=e=>te.outPrice=e),placeholder:"请输入出场价格"},null,8,["modelValue"])])),_:1}),g(s,{class:"input-group"},{default:c((()=>[g(s,{class:"input-label"},{default:c((()=>[m("出场描述")])),_:1}),g(k,{class:"log-textarea",modelValue:te.outDesc,"onUpdate:modelValue":l[8]||(l[8]=e=>te.outDesc=e),placeholder:"请输入出场描述（可选）",maxlength:"500","auto-height":""},null,8,["modelValue"])])),_:1}),g(s,{class:"input-group"},{default:c((()=>[g(s,{class:"input-label"},{default:c((()=>[m("出场图片")])),_:1}),g(s,{class:"image-upload"},{default:c((()=>[g(s,{class:"image-grid"},{default:c((()=>[g(s,{class:"upload-btn",onClick:Je},{default:c((()=>[g(a,{type:"plus",size:"30",color:"#667eea"})])),_:1}),(r(!0),_(I,null,v(te.existingImgs,((e,l)=>(r(),i(s,{class:"image-item",key:"existing-"+l},{default:c((()=>[g(t,{src:e.url,class:"preview-image",mode:"aspectFill",onClick:l=>je(e.url,Ue())},null,8,["src","onClick"]),g(s,{class:"delete-image",onClick:h((e=>(e=>{te.existingImgs.splice(e,1)})(l)),["stop"])},{default:c((()=>[g(a,{type:"close",size:"16",color:"#fff"})])),_:2},1032,["onClick"])])),_:2},1024)))),128)),(r(!0),_(I,null,v(te.addOutImgs,((e,l)=>(r(),i(s,{class:"image-item",key:"new-"+l},{default:c((()=>[g(t,{src:e.url,class:"preview-image",mode:"aspectFill",onClick:l=>je(e.url,Ue())},null,8,["src","onClick"]),g(s,{class:"delete-image",onClick:h((e=>(e=>{te.addOutImgs.splice(e,1)})(l)),["stop"])},{default:c((()=>[g(a,{type:"close",size:"16",color:"#fff"})])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1})])),_:1}),g(s,{class:"popup-actions"},{default:c((()=>[g(C,{class:"cancel-btn",onClick:Ve},{default:c((()=>[m("取消")])),_:1}),g(C,{class:"confirm-btn",onClick:Xe,disabled:!qe.value},{default:c((()=>[m(f(ae.value?"更新":"保存"),1)])),_:1},8,["disabled"])])),_:1})])),_:1},8,["class"])])),_:1})):d("",!0),se.value?(r(),i(s,{key:3,class:"modal-overlay",onClick:Be},{default:c((()=>[g(s,{class:p(["modal-content log-detail-view-modal",{closing:oe.value}]),onClick:l[10]||(l[10]=h((()=>{}),["stop"]))},{default:c((()=>[g(s,{class:"popup-header"},{default:c((()=>[g(o,{class:"popup-title"},{default:c((()=>[m("交易日志详情")])),_:1}),g(s,{class:"popup-close",onClick:Be},{default:c((()=>[g(a,{type:"close",size:"20",color:"#666"})])),_:1})])),_:1}),ne.value?(r(),i(y,{key:0,class:"form-content","scroll-y":"true"},{default:c((()=>[g(s,{class:"input-group readonly"},{default:c((()=>[g(s,{class:"input-label"},{default:c((()=>[m("入场描述")])),_:1}),g(s,{class:"readonly-content"},{default:c((()=>[m(f(ne.value.inDesc||"无"),1)])),_:1})])),_:1}),g(s,{class:"input-group readonly"},{default:c((()=>[g(s,{class:"input-label"},{default:c((()=>[m("入场价格")])),_:1}),g(s,{class:"readonly-content"},{default:c((()=>[m("¥"+f(ne.value.inPrice),1)])),_:1})])),_:1}),g(s,{class:"input-group readonly"},{default:c((()=>[g(s,{class:"input-label"},{default:c((()=>[m("交易方向")])),_:1}),g(s,{class:"readonly-content"},{default:c((()=>[g(s,{class:p(["direction-tag",ne.value.isRise?"rise":"fall"])},{default:c((()=>[m(f(ne.value.isRise?"做多(看涨)":"做空(看跌)"),1)])),_:1},8,["class"])])),_:1})])),_:1}),g(s,{class:"input-group readonly"},{default:c((()=>[g(s,{class:"input-label"},{default:c((()=>[m("手数")])),_:1}),g(s,{class:"readonly-content"},{default:c((()=>[m(f(ne.value.count)+"手",1)])),_:1})])),_:1}),g(s,{class:"input-group readonly"},{default:c((()=>[g(s,{class:"input-label"},{default:c((()=>[m("创建时间")])),_:1}),g(s,{class:"readonly-content"},{default:c((()=>[m(f(Pe(ne.value.createTime)),1)])),_:1})])),_:1}),g(s,{class:"input-group readonly"},{default:c((()=>[g(s,{class:"input-label"},{default:c((()=>[m("总盈亏")])),_:1}),g(s,{class:p(["readonly-content",Se(ne.value.profit)])},{default:c((()=>[m(f(Te(ne.value.profit)),1)])),_:1},8,["class"])])),_:1}),ne.value.inImgs?(r(),i(s,{key:0,class:"input-group readonly"},{default:c((()=>[g(s,{class:"input-label"},{default:c((()=>[m("入场图片")])),_:1}),g(s,{class:"readonly-images"},{default:c((()=>[g(s,{class:"image-grid"},{default:c((()=>[(r(!0),_(I,null,v(Ge(ne.value.inImgs),((e,l)=>(r(),i(s,{class:"image-item",key:l},{default:c((()=>[g(t,{src:e,class:"preview-image",mode:"aspectFill",onClick:l=>je(e,Ge(ne.value.inImgs))},null,8,["src","onClick"])])),_:2},1024)))),128))])),_:1}),0===Ge(ne.value.inImgs).length?(r(),i(s,{key:0,class:"no-images-text"},{default:c((()=>[m(" 无入场图片 ")])),_:1})):d("",!0)])),_:1})])),_:1})):d("",!0),ie.value.length>0?(r(),i(s,{key:1,class:"out-logs-section readonly"},{default:c((()=>[g(s,{class:"section-title"},{default:c((()=>[m("出场记录")])),_:1}),g(s,{class:"out-logs-list"},{default:c((()=>[(r(!0),_(I,null,v(ie.value,((e,l)=>(r(),i(s,{class:"out-log-item readonly",key:e.id},{default:c((()=>[g(s,{class:"out-log-header"},{default:c((()=>[g(o,{class:"out-log-date"},{default:c((()=>[m(f(Pe(e.createTime)),1)])),_:2},1024),g(o,{class:p(["out-log-profit",Se(e.profit)])},{default:c((()=>[m(f(Te(e.profit)),1)])),_:2},1032,["class"])])),_:2},1024),g(s,{class:"out-log-content"},{default:c((()=>[g(s,{class:"out-log-info"},{default:c((()=>[g(o,{class:"out-count"},{default:c((()=>[m("手数: "+f(e.count),1)])),_:2},1024)])),_:2},1024),e.outDesc?(r(),i(s,{key:0,class:"out-log-desc"},{default:c((()=>[g(o,{class:"desc-text"},{default:c((()=>[m(f(e.outDesc),1)])),_:2},1024)])),_:2},1024)):d("",!0),e.outImgs?(r(),i(s,{key:1,class:"out-log-images"},{default:c((()=>[g(s,{class:"out-images-grid"},{default:c((()=>[(r(!0),_(I,null,v(Me(e.outImgs),((l,a)=>(r(),i(s,{class:"out-image-item",key:a},{default:c((()=>[g(t,{src:l,class:"out-preview-image",mode:"aspectFill",onClick:t=>Ne(l,Me(e.outImgs))},null,8,["src","onClick"])])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024)):d("",!0)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})):d("",!0),ce.value?(r(),i(s,{key:2,class:"loading-section"},{default:c((()=>[g(o,{class:"loading-text"},{default:c((()=>[m("正在加载出场记录...")])),_:1})])),_:1})):d("",!0),ce.value||0!==ie.value.length?d("",!0):(r(),i(s,{key:3,class:"no-out-logs"},{default:c((()=>[g(o,{class:"no-out-logs-text"},{default:c((()=>[m("暂无出场记录")])),_:1})])),_:1}))])),_:1})):d("",!0),g(s,{class:"popup-actions"},{default:c((()=>[g(C,{class:"cancel-btn full-width",onClick:Be},{default:c((()=>[m("关闭")])),_:1})])),_:1})])),_:1},8,["class"])])),_:1})):d("",!0)])),_:1})}}},[["__scopeId","data-v-9ad1db63"]]);export{U as default};

import{r as e,p as a,o as l,a as t,c as s,w as o,s as u,i as n,b as c,g as i,d as r,e as d,u as v,v as p,F as f,n as m,f as _,J as k,y as h,z as y,j as b,k as g,S as C,I as w,l as T,x as I,t as z,C as x}from"./index-DwnOT4K7.js";import{r as V,_ as j}from"./uni-app.es.BBfL1HZQ.js";import{_ as X}from"./uni-card.BTl7MJ-D.js";import{r as D}from"./request.DtiC9qg0.js";import{u as S}from"./user.H6OceLeH.js";import{_ as U}from"./_plugin-vue_export-helper.BCo6x5W8.js";const M=()=>D.get("/templateTask/queryList"),R=e=>D.post("/templateTask/add",e),$=e=>D.post("/templateTask/upd",e),q=e=>D.delete(`/templateTask/del/${e}`),B=U({__name:"template",setup(D){const U=S(),B=e([]),E=e(!1),F=e({description:"",value:"1"}),L=e({id:null,description:"",value:"1"}),Y=e(!1),J=e(!1),O=e(!1),P=e(!1),A=e(!1),G=e(!1),H=e({}),K=e(0),N=e(0),Q=e(null),W=e(!1),Z=e(!1),ee=e(!1),ae=e(!1),le=a((()=>U.userInfo.backgroudImg||""));a((()=>le.value&&!E.value));const te=()=>{k({delta:1})},se=()=>{W.value=!0},oe=e=>{H.value[e]&&(H.value[e].translateX=0,H.value[e].showDelete=!1)},ue=()=>{Object.keys(H.value).forEach((e=>{oe(e)}))},ne=()=>{ue()},ce=e=>{},ie=async()=>{ae.value=!0,ee.value=!0;try{await xe(),u({title:"刷新成功",icon:"success",duration:1500})}catch(e){console.error("刷新失败:",e),u({title:"刷新失败，请重试",icon:"none",duration:2e3})}finally{setTimeout((()=>{ae.value=!1,ee.value=!1}),800)}},re=()=>{ae.value=!1,ee.value=!1},de=e=>{ue();const a=pe(e);a?x({title:"删除确认",content:`确定要删除"${a.taskDescription}"模板吗？`,confirmColor:"#f56c6c",success:async a=>{a.confirm&&await ve(e)}}):console.error("未找到要删除的模板:",e)},ve=async e=>{if(e){h({title:"删除中..."});try{const a=await q(e);y(),200===a.code||"200"===a.code?(u({title:"模板已删除",icon:"success"}),await xe()):u({title:a.message||"删除失败",icon:"none"})}catch(a){y(),u({title:"删除失败",icon:"none"}),console.error("删除模板失败:",a)}}},pe=e=>B.value.find((a=>a.id===e)),fe=()=>{Z.value=!0,setTimeout((()=>{W.value=!1,Z.value=!1}),300)},me=()=>{fe(),setTimeout((()=>{u({title:"排序功能待实现",icon:"none"})}),300)},_e=()=>{Y.value=!0,setTimeout((()=>{O.value=!0}),300)},ke=()=>{J.value=!0,O.value=!1,setTimeout((()=>{Y.value=!1,J.value=!1,F.value={description:"",value:"1"}}),300)},he=async()=>{if(F.value.description.trim()){h({title:"添加中..."});try{const e={desc:F.value.description.trim(),value:parseInt(F.value.value)||1},a=await R(e);y(),200===a.code||"200"===a.code?(ke(),u({title:"模板添加成功",icon:"success"}),xe()):u({title:a.message||"添加失败",icon:"none"})}catch(e){y(),u({title:"添加失败",icon:"none"}),console.error("添加模板失败:",e)}}else u({title:"请输入任务描述",icon:"none"})},ye=()=>{A.value=!0,G.value=!1,setTimeout((()=>{P.value=!1,A.value=!1,L.value={id:null,description:"",value:"1"}}),300)},be=async()=>{if(L.value.description.trim()){h({title:"修改中..."});try{const e={id:L.value.id,desc:L.value.description.trim(),value:parseInt(L.value.value)||1},a=await $(e);y(),200===a.code||"200"===a.code?(ye(),u({title:"模板修改成功",icon:"success"}),xe()):u({title:a.message||"修改失败",icon:"none"})}catch(e){y(),u({title:"修改失败",icon:"none"}),console.error("修改模板失败:",e)}}else u({title:"请输入任务描述",icon:"none"})},ge=e=>{let a=e.detail.value||e.target.value;a=a.replace(/[^\d]/g,""),a&&parseInt(a)<1&&(a="1"),a||(a="1"),F.value.value=a},Ce=()=>{const e=parseInt(F.value.value)||1;F.value.value=(e+1).toString()},we=()=>{const e=parseInt(F.value.value)||1;e>1&&(F.value.value=(e-1).toString())},Te=e=>{let a=e.detail.value||e.target.value;a=a.replace(/[^\d]/g,""),a&&parseInt(a)<1&&(a="1"),a||(a="1"),L.value.value=a},Ie=()=>{const e=parseInt(L.value.value)||1;L.value.value=(e+1).toString()},ze=()=>{const e=parseInt(L.value.value)||1;e>1&&(L.value.value=(e-1).toString())},xe=async()=>{try{const e=await M();e&&"200"===e.code&&e.data&&(B.value=e.data)}catch(e){console.error("获取模板列表失败:",e),u({title:"获取模板列表失败",icon:"none"})}},Ve=()=>{E.value=!0,u({title:"背景图片加载失败",icon:"none"})},je=()=>{E.value=!1};return l((()=>{U.initUserInfo(),xe()})),(e,a)=>{const l=b,u=V(t("uni-icons"),j),k=n,h=g,y=V(t("uni-card"),X),x=C,D=w,S=T;return c(),s(k,{class:"template-container"},{default:o((()=>[le.value?(c(),s(l,{key:0,src:le.value,class:"background-image",mode:"aspectFill",onError:Ve,onLoad:je},null,8,["src"])):i("",!0),r(k,{class:"nav-header"},{default:o((()=>[r(k,{class:"nav-left"},{default:o((()=>[r(u,{type:"back",size:"24",color:"#fff",onClick:te})])),_:1}),r(k,{class:"nav-center"},{default:o((()=>[r(h,{class:"nav-title"},{default:o((()=>[d("任务模板")])),_:1})])),_:1}),r(k,{class:"nav-right"},{default:o((()=>[r(u,{type:"more-filled",size:"24",color:"#fff",onClick:se})])),_:1})])),_:1}),r(x,{class:"task-list","scroll-y":"true",onScroll:ne,"refresher-enabled":"true","refresher-background":"transparent","refresher-triggered":ae.value,onRefresherpulling:ce,onRefresherrefresh:ie,onRefresherrestore:re},{default:o((()=>[(c(!0),v(f,null,p(B.value,((e,a)=>(c(),s(y,{key:e.id,"is-shadow":!1,border:!1,margin:"8rpx 20rpx",class:"task-card task-swipe-container"},{default:o((()=>[r(k,{class:"task-swipe-wrapper"},{default:o((()=>{var a,l;return[r(k,{class:"task-item",style:I({transform:`translateX(${(null==(a=H.value[e.id])?void 0:a.translateX)||0}rpx)`}),onTouchstart:a=>{return l=a,t=e.id,K.value=l.touches[0].clientX,N.value=l.touches[0].clientY,void(Q.value=t);var l,t},onTouchmove:a=>((e,a)=>{if(Q.value!==a)return;const l=e.touches[0].clientX,t=e.touches[0].clientY,s=l-K.value,o=t-N.value;if(!(Math.abs(o)>Math.abs(s))&&s<0){const e=Math.max(.5*s,-120);H.value[a]||(H.value[a]={}),H.value[a].translateX=e,H.value[a].showDelete=e<-30}})(a,e.id),onTouchend:a=>((e,a)=>{if(Q.value!==a)return;const l=H.value[a];l&&(l.translateX<-60?de(a):l.translateX<-30?(l.translateX=-120,l.showDelete=!0):oe(a),Q.value=null)})(0,e.id)},{default:o((()=>[r(k,{class:"template-icon"},{default:o((()=>[r(u,{type:"list",size:"24",color:"#667eea"})])),_:1}),r(k,{class:"task-content",onClick:a=>((e,a)=>{a&&a.stopPropagation(),L.value={id:e.id,description:e.taskDescription,value:e.value?e.value.toString():"1"},P.value=!0,setTimeout((()=>{G.value=!0}),300)})(e,a)},{default:o((()=>[r(h,{class:"task-description"},{default:o((()=>[d(z(e.taskDescription),1)])),_:2},1024),e.value&&e.value>=1?(c(),s(k,{key:0,class:"task-value"},{default:o((()=>[r(u,{type:"wallet",size:"14",color:"#666"}),r(h,{class:"value-text"},{default:o((()=>[d(z(e.value),1)])),_:2},1024)])),_:2},1024)):i("",!0)])),_:2},1032,["onClick"])])),_:2},1032,["style","onTouchstart","onTouchmove","onTouchend"]),(null==(l=H.value[e.id])?void 0:l.showDelete)?(c(),s(k,{key:0,class:"delete-action",onClick:a=>de(e.id)},{default:o((()=>[r(u,{type:"trash",size:"24",color:"#fff"})])),_:2},1032,["onClick"])):i("",!0)]})),_:2},1024)])),_:2},1024)))),128))])),_:1},8,["refresher-triggered"]),r(k,{class:"add-task-btn",onClick:_e},{default:o((()=>[r(u,{type:"plus",size:"20",color:"#fff"}),r(h,{class:"add-btn-text"},{default:o((()=>[d("添加模板")])),_:1})])),_:1}),Y.value?(c(),s(k,{key:1,class:"modal-overlay",onClick:ke},{default:o((()=>[r(k,{class:m(["modal-content",{closing:J.value}]),onClick:a[3]||(a[3]=_((()=>{}),["stop"]))},{default:o((()=>[r(k,{class:"popup-header"},{default:o((()=>[r(h,{class:"popup-title"},{default:o((()=>[d("新建模板")])),_:1}),r(k,{class:"popup-close",onClick:ke},{default:o((()=>[r(u,{type:"close",size:"20",color:"#666"})])),_:1})])),_:1}),r(k,{class:"input-group"},{default:o((()=>[r(k,{class:"input-label"},{default:o((()=>[d("任务描述")])),_:1}),r(D,{class:"task-input",modelValue:F.value.description,"onUpdate:modelValue":a[0]||(a[0]=e=>F.value.description=e),placeholder:"请输入任务描述...",maxlength:"100",focus:O.value,onBlur:a[1]||(a[1]=e=>O.value=!1)},null,8,["modelValue","focus"])])),_:1}),r(k,{class:"input-group"},{default:o((()=>[r(k,{class:"input-label"},{default:o((()=>[d("任务价值")])),_:1}),r(k,{class:"number-input-container"},{default:o((()=>[r(D,{class:"task-input number-input",modelValue:F.value.value,"onUpdate:modelValue":a[2]||(a[2]=e=>F.value.value=e),type:"number",placeholder:"最小值为1",onInput:ge},null,8,["modelValue"]),r(k,{class:"number-controls"},{default:o((()=>[r(k,{class:"control-btn increase-btn",onClick:Ce},{default:o((()=>[r(u,{type:"plus",size:"20",color:"#fff"})])),_:1}),r(k,{class:"control-btn decrease-btn",onClick:we},{default:o((()=>[r(u,{type:"minus",size:"20",color:"#fff"})])),_:1})])),_:1})])),_:1})])),_:1}),r(k,{class:"popup-actions"},{default:o((()=>[r(S,{class:"cancel-btn",onClick:ke},{default:o((()=>[d("取消")])),_:1}),r(S,{class:"confirm-btn",onClick:he,disabled:!F.value.description.trim()},{default:o((()=>[d("确认添加")])),_:1},8,["disabled"])])),_:1})])),_:1},8,["class"])])),_:1})):i("",!0),P.value?(c(),s(k,{key:2,class:"modal-overlay",onClick:ye},{default:o((()=>[r(k,{class:m(["modal-content",{closing:A.value}]),onClick:a[7]||(a[7]=_((()=>{}),["stop"]))},{default:o((()=>[r(k,{class:"popup-header"},{default:o((()=>[r(h,{class:"popup-title"},{default:o((()=>[d("修改模板")])),_:1}),r(k,{class:"popup-close",onClick:ye},{default:o((()=>[r(u,{type:"close",size:"20",color:"#666"})])),_:1})])),_:1}),r(k,{class:"input-group"},{default:o((()=>[r(k,{class:"input-label"},{default:o((()=>[d("任务描述")])),_:1}),r(D,{class:"task-input",modelValue:L.value.description,"onUpdate:modelValue":a[4]||(a[4]=e=>L.value.description=e),placeholder:"请输入任务描述...",maxlength:"100",focus:G.value,onBlur:a[5]||(a[5]=e=>G.value=!1)},null,8,["modelValue","focus"])])),_:1}),r(k,{class:"input-group"},{default:o((()=>[r(k,{class:"input-label"},{default:o((()=>[d("任务价值")])),_:1}),r(k,{class:"number-input-container"},{default:o((()=>[r(D,{class:"task-input number-input",modelValue:L.value.value,"onUpdate:modelValue":a[6]||(a[6]=e=>L.value.value=e),type:"number",placeholder:"最小值为1",onInput:Te},null,8,["modelValue"]),r(k,{class:"number-controls"},{default:o((()=>[r(k,{class:"control-btn increase-btn",onClick:Ie},{default:o((()=>[r(u,{type:"plus",size:"20",color:"#fff"})])),_:1}),r(k,{class:"control-btn decrease-btn",onClick:ze},{default:o((()=>[r(u,{type:"minus",size:"20",color:"#fff"})])),_:1})])),_:1})])),_:1})])),_:1}),r(k,{class:"popup-actions"},{default:o((()=>[r(S,{class:"cancel-btn",onClick:ye},{default:o((()=>[d("取消")])),_:1}),r(S,{class:"confirm-btn",onClick:be,disabled:!L.value.description.trim()},{default:o((()=>[d("确认修改")])),_:1},8,["disabled"])])),_:1})])),_:1},8,["class"])])),_:1})):i("",!0),W.value?(c(),s(k,{key:3,class:"modal-overlay",onClick:fe},{default:o((()=>[r(k,{class:m(["modal-content more-menu",{closing:Z.value}]),onClick:a[8]||(a[8]=_((()=>{}),["stop"]))},{default:o((()=>[r(k,{class:"menu-header"},{default:o((()=>[r(k,{class:"menu-handle"}),r(h,{class:"menu-title"},{default:o((()=>[d("模板选项")])),_:1}),r(h,{class:"menu-done",onClick:fe},{default:o((()=>[d("完成")])),_:1})])),_:1}),r(k,{class:"menu-items"},{default:o((()=>[r(k,{class:"menu-item",onClick:me},{default:o((()=>[r(u,{type:"reload",size:"20",color:"#333"}),r(h,{class:"menu-text"},{default:o((()=>[d("排序")])),_:1})])),_:1})])),_:1})])),_:1},8,["class"])])),_:1})):i("",!0)])),_:1})}}},[["__scopeId","data-v-4b1ac88c"]]);export{B as default};

import{r as e,p as l,o as a,a as t,c as s,w as u,s as n,i as o,b as i,g as c,d,e as r,u as v,v as p,F as f,n as m,t as _,f as y,J as h,y as g,z as k,j as b,k as w,S as C,I as x,M as T,l as D,P as z,N,x as S,C as V}from"./index-DwnOT4K7.js";import{o as I,r as $,_ as X}from"./uni-app.es.BBfL1HZQ.js";import{_ as M}from"./uni-card.BTl7MJ-D.js";import{r as F}from"./request.DtiC9qg0.js";import{u as j}from"./user.H6OceLeH.js";import{u as H}from"./utilApi.BUPvZiR4.js";import{_ as Y}from"./_plugin-vue_export-helper.BCo6x5W8.js";const U=e=>F.post("/milestone/list",e),B=e=>F.post("/milestone/add",e),O=e=>F.post("/milestone/upd",e),P=e=>F.delete(`/milestone/del/${e}`),R=e=>F.get(`/milestone/complete/${e}`),A=Y({__name:"milestore",setup(F){const Y=j(),A=e([]),E=e({title:"",type:1,value:"1",desc:"",deadline:""}),q=e(!1),J=e(!1),L=e(!1),G=e(!1),K=e(!1),Q=e(!1),W=e({id:null,title:"",type:1,value:"1",desc:"",deadline:""}),Z=e(!1),ee=e(""),le=e(""),ae=e(""),te=e(""),se=e({year:(new Date).getFullYear(),month:(new Date).getMonth()+1,day:(new Date).getDate()});l((()=>`${se.value.year}-${String(se.value.month).padStart(2,"0")}-${String(se.value.day).padStart(2,"0")}`));const ue=e([0,0,0]),ne=l((()=>{const e=[];for(let l=0;l<10;l++)e.push(se.value.year+l);return e})),oe=l((()=>{const e=[];for(let l=ne.value[ue.value[0]]===se.value.year?se.value.month:1;l<=12;l++)e.push(l);return e})),ie=l((()=>{const e=ne.value[ue.value[0]],l=oe.value[ue.value[1]],a=new Date(e,l,0).getDate(),t=[];for(let s=e===se.value.year&&l===se.value.month?se.value.day:1;s<=a;s++)t.push(s);return t})),ce=e(!1),de=e(!1),re=e({}),ve=e({}),pe=e(0),fe=e(0),me=e(null),_e=e(!1),ye=e(!1),he=e(!1),ge=l((()=>Y.userInfo.backgroudImg||"")),ke=l((()=>{const e=new Date;return e.setHours(0,0,0,0),A.value.filter((l=>{if(l.isComplete)return!1;if(!l.deadline)return!0;let a;return a="number"!=typeof l.deadline&&isNaN(Number(l.deadline))?new Date(l.deadline):new Date(Number(l.deadline)),a.setHours(23,59,59,999),a>=e})).sort(((e,l)=>(e.sort||0)-(l.sort||0)))})),be=l((()=>A.value.filter((e=>e.isComplete)).sort(((e,l)=>(e.sort||0)-(l.sort||0))))),we=l((()=>{const e=new Date;return e.setHours(0,0,0,0),A.value.filter((l=>{if(l.isComplete)return!1;if(!l.deadline)return!1;let a;return a="number"!=typeof l.deadline&&isNaN(Number(l.deadline))?new Date(l.deadline):new Date(Number(l.deadline)),a.setHours(23,59,59,999),a<e})).sort(((e,l)=>(e.sort||0)-(l.sort||0)))})),Ce=l((()=>E.value.title.trim()&&E.value.desc.trim()&&E.value.deadline&&parseInt(E.value.value)>=1&&!ae.value)),xe=l((()=>W.value.title.trim()&&W.value.desc.trim()&&W.value.deadline&&parseInt(W.value.value)>=1&&!te.value)),Te=()=>{h()},De=()=>{he.value=!0},ze=()=>{he.value=!1},Ne=e=>{if(!e)return"";let l;if(l="number"!=typeof e&&isNaN(Number(e))?new Date(e):new Date(Number(e)),isNaN(l.getTime()))return e;return`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}-${String(l.getDate()).padStart(2,"0")}`},Se=e=>{if(!e)return"";let l;if(l="number"!=typeof e&&isNaN(Number(e))?new Date(e):new Date(Number(e)),isNaN(l.getTime()))return"";l.setHours(23,59,59,999);const a=new Date;a.setHours(0,0,0,0);const t=l.getTime()-a.getTime(),s=Math.ceil(t/864e5);return s<0?"已逾期"+Math.abs(s)+"天":0===s?"今天截止":"剩余"+s+"天"},Ve=e=>{if(!e)return"";let l;if(l="number"!=typeof e&&isNaN(Number(e))?new Date(e):new Date(Number(e)),isNaN(l.getTime()))return"";l.setHours(23,59,59,999);const a=new Date;a.setHours(0,0,0,0);const t=l.getTime()-a.getTime(),s=Math.ceil(t/864e5);return s<0?"overdue":s<=7?"urgent":s<=30?"warning":"safe"},Ie=(e,l)=>{l&&l.stopPropagation(),re.value[e]=!re.value[e]},$e=async e=>{const l=Ae(e);l?l.isComplete?V({title:"确认操作",content:`确定设置"${l.title}"为未完成吗？`,confirmColor:"#667eea",success:async l=>{l.confirm&&await Xe(e)}}):await Xe(e):console.error("未找到要操作的里程碑:",e)},Xe=async e=>{try{const l=await R(e);200===l.code||"200"===l.code?await pl():n({title:l.message||"操作失败",icon:"none"})}catch(l){console.error("切换里程碑状态失败:",l),n({title:"操作失败",icon:"none"})}},Me=()=>{ce.value=!ce.value},Fe=()=>{de.value=!de.value},je=(e,l)=>{pe.value=e.touches[0].clientX,fe.value=e.touches[0].clientY,me.value=l},He=(e,l)=>{if(me.value!==l)return;const a=e.touches[0].clientX,t=e.touches[0].clientY,s=a-pe.value,u=t-fe.value;if(!(Math.abs(u)>Math.abs(s))&&s<0){const e=Math.max(.5*s,-120);ve.value[l]||(ve.value[l]={}),ve.value[l].translateX=e,ve.value[l].showDelete=e<-30}},Ye=(e,l)=>{if(me.value!==l)return;const a=ve.value[l];a&&(a.translateX<-60?Pe(l):a.translateX<-30?(a.translateX=-120,a.showDelete=!0):Ue(l),me.value=null)},Ue=e=>{ve.value[e]&&(ve.value[e].translateX=0,ve.value[e].showDelete=!1)},Be=()=>{Object.keys(ve.value).forEach((e=>{Ue(e)}))},Oe=()=>{Be()},Pe=e=>{Be();const l=Ae(e);l?V({title:"删除确认",content:`确定要删除"${l.title}"里程碑吗？`,confirmColor:"#f56c6c",success:async l=>{l.confirm&&await Re(e)}}):console.error("未找到要删除的里程碑:",e)},Re=async e=>{if(e){g({title:"删除中..."});try{const l=await P(e);k(),200===l.code||"200"===l.code?(n({title:"里程碑已删除",icon:"success"}),await pl()):n({title:l.message||"删除失败",icon:"none"})}catch(l){k(),n({title:"删除失败",icon:"none"}),console.error("删除里程碑失败:",l)}}},Ae=e=>A.value.find((l=>l.id===e)),Ee=async e=>{if(await(async()=>{try{const e=await H.now();if(e&&200===e.code&&e.data){const l=new Date(e.data);se.value={year:l.getFullYear(),month:l.getMonth()+1,day:l.getDate()}}}catch(e){console.error("获取服务器时间失败:",e);const l=new Date;se.value={year:l.getFullYear(),month:l.getMonth()+1,day:l.getDate()}}})(),e){const l=new Date(e),a=l.getFullYear(),t=l.getMonth()+1,s=l.getDate();if(new Date(a,t-1,s).getTime()<new Date(se.value.year,se.value.month-1,se.value.day).getTime()){const e=0,l=0,a=0;ue.value=[e,l,a]}else{const e=ne.value.indexOf(a);if(e<0)ue.value=[0,0,0];else{const l=oe.value.indexOf(t);if(l<0)ue.value=[e,0,0];else{const u=new Array(31).fill(0).map(((e,l)=>l+1)).filter((e=>a!==se.value.year||t!==se.value.month||e>=se.value.day)).indexOf(s);ue.value=u<0?[e,l,0]:[e,l,u]}}}Je()}else{const e=0,l=0,a=0;ue.value=[e,l,a],Je()}},qe=e=>{let[l,a,t]=e.detail.value;const s=ne.value[l],u=oe.value[a];s===se.value.year&&a>=oe.value.length&&(a=0),new Date(s,u,0).getDate();s===se.value.year&&u===se.value.month&&t>=ie.value.length&&(t=0),t>=ie.value.length&&(t=ie.value.length-1),ue.value=[l,a,t],Je()},Je=()=>{const e=ne.value[ue.value[0]],l=oe.value[ue.value[1]],a=ie.value[ue.value[2]];if(e&&l&&a){const t=String(l).padStart(2,"0"),s=String(a).padStart(2,"0");ee.value=`${e}-${t}-${s}`}},Le=async()=>{J.value=!0,setTimeout((async()=>{q.value=!1,J.value=!1,setTimeout((async()=>{le.value="new";const e=E.value.deadline?new Date(Number(E.value.deadline)):null;await Ee(e),Z.value=!0}),100)}),300)},Ge=async()=>{K.value=!0,setTimeout((async()=>{G.value=!1,K.value=!1,setTimeout((async()=>{le.value="edit";const e=W.value.deadline?new Date(Number(W.value.deadline)):null;await Ee(e),Z.value=!0}),100)}),300)},Ke=()=>{Z.value=!1,ee.value="",setTimeout((()=>{"new"===le.value?(q.value=!0,setTimeout((()=>{L.value=!0}),300)):"edit"===le.value&&(G.value=!0,setTimeout((()=>{Q.value=!0}),300)),le.value=""}),300)},Qe=(e,l=!1)=>{if(!e)return"请选择截止日期";const a=new Date(e),t=new Date(se.value.year,se.value.month-1,se.value.day);return t.setHours(0,0,0,0),a<t?"截止日期不能小于当前时间":""},We=()=>{if(!ee.value)return void n({title:"请选择日期",icon:"none"});const e=Qe(ee.value,"edit"===le.value);e?n({title:e,icon:"none"}):("new"===le.value?(E.value.deadline=ee.value,ae.value=""):"edit"===le.value&&(W.value.deadline=ee.value,te.value=""),Ke(),setTimeout((()=>{"new"===le.value?(q.value=!0,setTimeout((()=>{L.value=!0}),300)):"edit"===le.value&&(G.value=!0,setTimeout((()=>{Q.value=!0}),300))}),300))},Ze=()=>{q.value=!0,setTimeout((()=>{L.value=!0}),300)},el=()=>{J.value=!0,L.value=!1,setTimeout((()=>{q.value=!1,J.value=!1,E.value={title:"",type:1,value:"1",desc:"",deadline:""},ae.value=""}),300)},ll=e=>{let l=e.detail.value||e.target.value;l=l.replace(/[^\d]/g,""),l&&parseInt(l)<1&&(l="1"),l||(l="1"),E.value.value=l},al=()=>{const e=parseInt(E.value.value)||1;E.value.value=(e+1).toString()},tl=()=>{const e=parseInt(E.value.value)||1;e>1&&(E.value.value=(e-1).toString())},sl=async()=>{if(!Ce.value)return;const e=Qe(E.value.deadline);if(e)return ae.value=e,void n({title:e,icon:"none"});g({title:"添加中..."});try{const e={title:E.value.title.trim(),type:E.value.type,value:parseInt(E.value.value)||1,desc:E.value.desc.trim(),deadline:E.value.deadline},l=await B(e);k(),200===l.code||"200"===l.code?(el(),n({title:"里程碑添加成功",icon:"success"}),pl()):n({title:l.message||"添加失败",icon:"none"})}catch(l){k(),n({title:"添加失败",icon:"none"}),console.error("添加里程碑失败:",l)}},ul=()=>{K.value=!0,Q.value=!1,setTimeout((()=>{G.value=!1,K.value=!1,W.value={id:null,title:"",type:1,value:"1",desc:"",deadline:""},te.value=""}),300)},nl=e=>{let l=e.detail.value||e.target.value;l=l.replace(/[^\d]/g,""),l&&parseInt(l)<1&&(l="1"),l||(l="1"),W.value.value=l},ol=()=>{const e=parseInt(W.value.value)||1;W.value.value=(e+1).toString()},il=()=>{const e=parseInt(W.value.value)||1;e>1&&(W.value.value=(e-1).toString())},cl=async()=>{if(!xe.value)return;const e=Qe(W.value.deadline,!0);if(e)return te.value=e,void n({title:e,icon:"none"});g({title:"修改中..."});try{const e={id:W.value.id,title:W.value.title.trim(),type:W.value.type,value:parseInt(W.value.value)||1,desc:W.value.desc.trim(),deadline:W.value.deadline},l=await O(e);k(),200===l.code||"200"===l.code?(ul(),n({title:"里程碑修改成功",icon:"success"}),pl()):n({title:l.message||"修改失败",icon:"none"})}catch(l){k(),n({title:"修改失败",icon:"none"}),console.error("修改里程碑失败:",l)}},dl=e=>{},rl=async()=>{ye.value=!0,_e.value=!0;try{await pl(),n({title:"刷新成功",icon:"success",duration:1500})}catch(e){console.error("刷新失败:",e),n({title:"刷新失败，请重试",icon:"none",duration:2e3})}finally{setTimeout((()=>{ye.value=!1,_e.value=!1}),800)}},vl=()=>{ye.value=!1,_e.value=!1},pl=async()=>{try{const e=await U();e&&"200"===e.code&&e.data&&(A.value=e.data)}catch(e){console.error("获取里程碑列表失败:",e),n({title:"获取里程碑列表失败",icon:"none"})}};return a((()=>{pl()})),I((()=>{pl()})),(e,l)=>{const a=b,n=$(t("uni-icons"),X),h=o,g=w,k=$(t("uni-card"),M),V=C,I=x,F=T,j=D,H=z,Y=N;return i(),s(h,{class:"milestore-container"},{default:u((()=>[ge.value?(i(),s(a,{key:0,src:ge.value,class:"background-image",mode:"aspectFill",onError:De,onLoad:ze},null,8,["src"])):c("",!0),d(h,{class:"nav-header"},{default:u((()=>[d(h,{class:"nav-left"},{default:u((()=>[d(h,{class:"back-button",onClick:Te},{default:u((()=>[d(n,{type:"back",size:"24",color:"#fff"})])),_:1})])),_:1}),d(h,{class:"nav-center"},{default:u((()=>[d(g,{class:"nav-title"},{default:u((()=>[r("里程碑")])),_:1})])),_:1}),d(h,{class:"nav-right"})])),_:1}),d(V,{class:"milestone-list","scroll-y":"true",onScroll:Oe,"refresher-enabled":"true","refresher-background":"transparent","refresher-triggered":ye.value,onRefresherpulling:dl,onRefresherrefresh:rl,onRefresherrestore:vl,style:{top:"160rpx"}},{default:u((()=>[(i(!0),v(f,null,p(ke.value,((e,l)=>(i(),s(k,{key:e.id,"is-shadow":!1,border:!1,margin:"8rpx 20rpx",class:"milestone-card milestone-swipe-container"},{default:u((()=>[d(h,{class:"milestone-swipe-wrapper"},{default:u((()=>{var l,a;return[d(h,{class:"milestone-item",style:S({transform:`translateX(${(null==(l=ve.value[e.id])?void 0:l.translateX)||0}rpx)`}),onTouchstart:l=>je(l,e.id),onTouchmove:l=>He(l,e.id),onTouchend:l=>Ye(0,e.id)},{default:u((()=>[d(h,{class:"milestone-checkbox",onClick:l=>$e(e.id)},{default:u((()=>[d(n,{type:"checkbox",size:24,color:"#C7C7CC"})])),_:2},1032,["onClick"]),d(h,{class:"milestone-content",onClick:l=>Ie(e.id,l)},{default:u((()=>[d(h,{class:"milestone-header"},{default:u((()=>[d(g,{class:"milestone-title"},{default:u((()=>[r(_(e.title),1)])),_:2},1024)])),_:2},1024),d(h,{class:"milestone-info"},{default:u((()=>[e.value&&e.value>=1?(i(),s(h,{key:0,class:"milestone-value"},{default:u((()=>[d(n,{type:"wallet",size:"14",color:"#666"}),d(g,{class:"value-text"},{default:u((()=>[r(_(e.value),1)])),_:2},1024)])),_:2},1024)):c("",!0),e.deadline?(i(),s(h,{key:1,class:"milestone-deadline"},{default:u((()=>[d(n,{type:"calendar",size:"14",color:"#666"}),d(g,{class:"deadline-text"},{default:u((()=>[r(_(Ne(e.deadline)),1)])),_:2},1024),e.isComplete&&e.completeTime?(i(),s(g,{key:0,class:"complete-time-text"},{default:u((()=>[d(g,{class:"icon-space"},{default:u((()=>[d(n,{type:"checkmarkempty",size:"14",color:"#4CD964"})])),_:1}),r(" "+_(Ne(e.completeTime)),1)])),_:2},1024)):c("",!0),e.isComplete?c("",!0):(i(),s(g,{key:1,class:m(["remaining-days",Ve(e.deadline)])},{default:u((()=>[r(" ("+_(Se(e.deadline))+") ",1)])),_:2},1032,["class"]))])),_:2},1024)):c("",!0)])),_:2},1024),re.value[e.id]?(i(),s(h,{key:0,class:m(["milestone-description",{expanded:re.value[e.id]}])},{default:u((()=>[d(g,{class:"description-text"},{default:u((()=>[r(_(e.desc),1)])),_:2},1024)])),_:2},1032,["class"])):c("",!0)])),_:2},1032,["onClick"]),d(h,{class:"milestone-actions"},{default:u((()=>[d(n,{type:"compose",size:24,color:"#667eea",onClick:l=>((e,l)=>{l&&l.stopPropagation(),e.isComplete||(W.value={id:e.id,title:e.title,type:e.type,value:e.value?e.value.toString():"1",desc:e.desc,deadline:e.deadline||""},console.log("编辑里程碑日期:",e.deadline,Ne(e.deadline)),te.value="",G.value=!0,setTimeout((()=>{Q.value=!0}),300))})(e,l)},null,8,["onClick"])])),_:2},1024)])),_:2},1032,["style","onTouchstart","onTouchmove","onTouchend"]),(null==(a=ve.value[e.id])?void 0:a.showDelete)?(i(),s(h,{key:0,class:"delete-action",onClick:l=>Pe(e.id)},{default:u((()=>[d(n,{type:"trash",size:"24",color:"#fff"})])),_:2},1032,["onClick"])):c("",!0)]})),_:2},1024)])),_:2},1024)))),128)),be.value.length>0?(i(),s(h,{key:0,class:"section-title",onClick:Me},{default:u((()=>[d(n,{type:ce.value?"down":"right",size:"16",color:"rgba(255, 255, 255, 0.7)"},null,8,["type"]),d(g,{class:"section-text"},{default:u((()=>[r("已完成")])),_:1})])),_:1})):c("",!0),d(h,{class:m(["completed-milestones-container",{collapsed:!ce.value}])},{default:u((()=>[(i(!0),v(f,null,p(be.value,((e,l)=>(i(),s(k,{key:e.id,"is-shadow":!1,border:!1,margin:"8rpx 20rpx",class:"milestone-card milestone-swipe-container"},{default:u((()=>[d(h,{class:"milestone-swipe-wrapper"},{default:u((()=>{var l,a;return[d(h,{class:"milestone-item",style:S({transform:`translateX(${(null==(l=ve.value[e.id])?void 0:l.translateX)||0}rpx)`}),onTouchstart:l=>je(l,e.id),onTouchmove:l=>He(l,e.id),onTouchend:l=>Ye(0,e.id)},{default:u((()=>[d(h,{class:"milestone-checkbox",onClick:l=>$e(e.id)},{default:u((()=>[d(n,{type:"checkbox",size:24,color:"#4CD964"})])),_:2},1032,["onClick"]),d(h,{class:"milestone-content completed-milestone",onClick:l=>Ie(e.id,l)},{default:u((()=>[d(h,{class:"milestone-header"},{default:u((()=>[d(g,{class:"milestone-title completed"},{default:u((()=>[r(_(e.title),1)])),_:2},1024)])),_:2},1024),d(h,{class:"milestone-info"},{default:u((()=>[e.value&&e.value>=1?(i(),s(h,{key:0,class:"milestone-value"},{default:u((()=>[d(n,{type:"wallet",size:"14",color:"#666"}),d(g,{class:"value-text"},{default:u((()=>[r(_(e.value),1)])),_:2},1024)])),_:2},1024)):c("",!0),e.deadline?(i(),s(h,{key:1,class:"milestone-deadline"},{default:u((()=>[d(n,{type:"calendar",size:"14",color:"#666"}),d(g,{class:"deadline-text"},{default:u((()=>[r(_(Ne(e.deadline)),1)])),_:2},1024),e.completeTime?(i(),s(g,{key:0,class:"complete-time-text"},{default:u((()=>[d(g,{class:"icon-space"},{default:u((()=>[d(n,{type:"checkmarkempty",size:"14",color:"#4CD964"})])),_:1}),r(" "+_(Ne(e.completeTime)),1)])),_:2},1024)):c("",!0)])),_:2},1024)):c("",!0)])),_:2},1024),re.value[e.id]?(i(),s(h,{key:0,class:m(["milestone-description",{expanded:re.value[e.id]}])},{default:u((()=>[d(g,{class:"description-text"},{default:u((()=>[r(_(e.desc),1)])),_:2},1024)])),_:2},1032,["class"])):c("",!0)])),_:2},1032,["onClick"]),c("",!0)])),_:2},1032,["style","onTouchstart","onTouchmove","onTouchend"]),(null==(a=ve.value[e.id])?void 0:a.showDelete)?(i(),s(h,{key:0,class:"delete-action",onClick:l=>Pe(e.id)},{default:u((()=>[d(n,{type:"trash",size:"24",color:"#fff"})])),_:2},1032,["onClick"])):c("",!0)]})),_:2},1024)])),_:2},1024)))),128))])),_:1},8,["class"]),we.value.length>0?(i(),s(h,{key:1,class:"section-title",onClick:Fe},{default:u((()=>[d(n,{type:de.value?"down":"right",size:"16",color:"rgba(255, 255, 255, 0.7)"},null,8,["type"]),d(g,{class:"section-text"},{default:u((()=>[r("已逾期")])),_:1})])),_:1})):c("",!0),d(h,{class:m(["overdue-milestones-container",{collapsed:!de.value}])},{default:u((()=>[(i(!0),v(f,null,p(we.value,((e,l)=>(i(),s(k,{key:e.id,"is-shadow":!1,border:!1,margin:"8rpx 20rpx",class:"milestone-card milestone-swipe-container"},{default:u((()=>[d(h,{class:"milestone-swipe-wrapper"},{default:u((()=>{var l,a;return[d(h,{class:"milestone-item overdue-item",style:S({transform:`translateX(${(null==(l=ve.value[e.id])?void 0:l.translateX)||0}rpx)`}),onTouchstart:l=>je(l,e.id),onTouchmove:l=>He(l,e.id),onTouchend:l=>Ye(0,e.id)},{default:u((()=>[d(h,{class:"milestone-checkbox disabled"},{default:u((()=>[d(n,{type:"circle",size:24,color:"#FF3B30"})])),_:1}),d(h,{class:"milestone-content overdue-milestone",onClick:l=>Ie(e.id,l)},{default:u((()=>[d(h,{class:"milestone-header"},{default:u((()=>[d(g,{class:"milestone-title overdue"},{default:u((()=>[r(_(e.title),1)])),_:2},1024)])),_:2},1024),d(h,{class:"milestone-info"},{default:u((()=>[e.value&&e.value>=1?(i(),s(h,{key:0,class:"milestone-value"},{default:u((()=>[d(n,{type:"wallet",size:"14",color:"#666"}),d(g,{class:"value-text"},{default:u((()=>[r(_(e.value),1)])),_:2},1024)])),_:2},1024)):c("",!0),e.deadline?(i(),s(h,{key:1,class:"milestone-deadline"},{default:u((()=>[d(n,{type:"calendar",size:"14",color:"#666"}),d(g,{class:"deadline-text"},{default:u((()=>[r(_(Ne(e.deadline)),1)])),_:2},1024),d(g,{class:"overdue-text"},{default:u((()=>[d(g,{class:"icon-space"},{default:u((()=>[d(n,{type:"closeempty",size:"14",color:"#FF3B30"})])),_:1})])),_:1})])),_:2},1024)):c("",!0)])),_:2},1024),re.value[e.id]?(i(),s(h,{key:0,class:m(["milestone-description",{expanded:re.value[e.id]}])},{default:u((()=>[d(g,{class:"description-text"},{default:u((()=>[r(_(e.desc),1)])),_:2},1024)])),_:2},1032,["class"])):c("",!0)])),_:2},1032,["onClick"]),c("",!0)])),_:2},1032,["style","onTouchstart","onTouchmove","onTouchend"]),(null==(a=ve.value[e.id])?void 0:a.showDelete)?(i(),s(h,{key:0,class:"delete-action",onClick:l=>Pe(e.id)},{default:u((()=>[d(n,{type:"trash",size:"24",color:"#fff"})])),_:2},1032,["onClick"])):c("",!0)]})),_:2},1024)])),_:2},1024)))),128))])),_:1},8,["class"])])),_:1},8,["refresher-triggered"]),d(h,{class:"add-milestone-container"},{default:u((()=>[d(h,{class:"add-milestone-btn",onClick:Ze},{default:u((()=>[d(n,{type:"plus",size:"20",color:"#fff"}),d(g,{class:"add-btn-text"},{default:u((()=>[r("新建里程碑")])),_:1})])),_:1})])),_:1}),q.value?(i(),s(h,{key:1,class:"modal-overlay",onClick:el},{default:u((()=>[d(h,{class:m(["modal-content",{closing:J.value}]),onClick:l[4]||(l[4]=y((()=>{}),["stop"]))},{default:u((()=>[d(h,{class:"popup-header"},{default:u((()=>[d(g,{class:"popup-title"},{default:u((()=>[r("新建里程碑")])),_:1}),d(h,{class:"popup-close",onClick:el},{default:u((()=>[d(n,{type:"close",size:"20",color:"#666"})])),_:1})])),_:1}),d(h,{class:"input-group"},{default:u((()=>[d(h,{class:"input-label"},{default:u((()=>[r("标题")])),_:1}),d(I,{class:"milestone-input",modelValue:E.value.title,"onUpdate:modelValue":l[0]||(l[0]=e=>E.value.title=e),placeholder:"请输入里程碑标题...",maxlength:"50",focus:L.value,onBlur:l[1]||(l[1]=e=>L.value=!1)},null,8,["modelValue","focus"])])),_:1}),d(h,{class:"input-group"},{default:u((()=>[d(h,{class:"input-label"},{default:u((()=>[r("价值")])),_:1}),d(h,{class:"number-input-container"},{default:u((()=>[d(I,{class:"milestone-input number-input",modelValue:E.value.value,"onUpdate:modelValue":l[2]||(l[2]=e=>E.value.value=e),type:"number",placeholder:"最小值为1",onInput:ll},null,8,["modelValue"]),d(h,{class:"number-controls"},{default:u((()=>[d(h,{class:"control-btn increase-btn",onClick:al},{default:u((()=>[d(n,{type:"plus",size:"20",color:"#fff"})])),_:1}),d(h,{class:"control-btn decrease-btn",onClick:tl},{default:u((()=>[d(n,{type:"minus",size:"20",color:"#fff"})])),_:1})])),_:1})])),_:1})])),_:1}),d(h,{class:"input-group"},{default:u((()=>[d(h,{class:"input-label"},{default:u((()=>[r("截止日期")])),_:1}),d(h,{class:"date-picker-container",onClick:Le},{default:u((()=>[d(h,{class:"date-picker-display"},{default:u((()=>[d(g,{class:"date-text"},{default:u((()=>[r(_(E.value.deadline?Ne(E.value.deadline):"请选择截止日期"),1)])),_:1}),d(n,{type:"calendar",size:"20",color:"#999"})])),_:1})])),_:1}),ae.value?(i(),s(h,{key:0,class:m(["error-tip",{show:ae.value}])},{default:u((()=>[d(g,{class:"error-text"},{default:u((()=>[r(_(ae.value),1)])),_:1})])),_:1},8,["class"])):c("",!0)])),_:1}),d(h,{class:"input-group"},{default:u((()=>[d(h,{class:"input-label"},{default:u((()=>[r("详细描述")])),_:1}),d(F,{class:"milestone-textarea",modelValue:E.value.desc,"onUpdate:modelValue":l[3]||(l[3]=e=>E.value.desc=e),placeholder:"请输入详细描述...",maxlength:"500","auto-height":!0},null,8,["modelValue"])])),_:1}),d(h,{class:"popup-actions"},{default:u((()=>[d(j,{class:"cancel-btn",onClick:el},{default:u((()=>[r("取消")])),_:1}),d(j,{class:"confirm-btn",onClick:sl,disabled:!Ce.value},{default:u((()=>[r("确认添加")])),_:1},8,["disabled"])])),_:1})])),_:1},8,["class"])])),_:1})):c("",!0),G.value?(i(),s(h,{key:2,class:"modal-overlay",onClick:ul},{default:u((()=>[d(h,{class:m(["modal-content",{closing:K.value}]),onClick:l[9]||(l[9]=y((()=>{}),["stop"]))},{default:u((()=>[d(h,{class:"popup-header"},{default:u((()=>[d(g,{class:"popup-title"},{default:u((()=>[r("修改里程碑")])),_:1}),d(h,{class:"popup-close",onClick:ul},{default:u((()=>[d(n,{type:"close",size:"20",color:"#666"})])),_:1})])),_:1}),d(h,{class:"input-group"},{default:u((()=>[d(h,{class:"input-label"},{default:u((()=>[r("标题")])),_:1}),d(I,{class:"milestone-input",modelValue:W.value.title,"onUpdate:modelValue":l[5]||(l[5]=e=>W.value.title=e),placeholder:"请输入里程碑标题...",maxlength:"50",focus:Q.value,onBlur:l[6]||(l[6]=e=>Q.value=!1)},null,8,["modelValue","focus"])])),_:1}),d(h,{class:"input-group"},{default:u((()=>[d(h,{class:"input-label"},{default:u((()=>[r("价值")])),_:1}),d(h,{class:"number-input-container"},{default:u((()=>[d(I,{class:"milestone-input number-input",modelValue:W.value.value,"onUpdate:modelValue":l[7]||(l[7]=e=>W.value.value=e),type:"number",placeholder:"最小值为1",onInput:nl},null,8,["modelValue"]),d(h,{class:"number-controls"},{default:u((()=>[d(h,{class:"control-btn increase-btn",onClick:ol},{default:u((()=>[d(n,{type:"plus",size:"20",color:"#fff"})])),_:1}),d(h,{class:"control-btn decrease-btn",onClick:il},{default:u((()=>[d(n,{type:"minus",size:"20",color:"#fff"})])),_:1})])),_:1})])),_:1})])),_:1}),d(h,{class:"input-group"},{default:u((()=>[d(h,{class:"input-label"},{default:u((()=>[r("截止日期")])),_:1}),d(h,{class:"date-picker-container",onClick:Ge},{default:u((()=>[d(h,{class:"date-picker-display"},{default:u((()=>[d(g,{class:"date-text"},{default:u((()=>[r(_(W.value.deadline?Ne(W.value.deadline):"请选择截止日期"),1)])),_:1}),d(n,{type:"calendar",size:"20",color:"#999"})])),_:1})])),_:1}),te.value?(i(),s(h,{key:0,class:m(["error-tip",{show:te.value}])},{default:u((()=>[d(g,{class:"error-text"},{default:u((()=>[r(_(te.value),1)])),_:1})])),_:1},8,["class"])):c("",!0)])),_:1}),d(h,{class:"input-group"},{default:u((()=>[d(h,{class:"input-label"},{default:u((()=>[r("详细描述")])),_:1}),d(F,{class:"milestone-textarea",modelValue:W.value.desc,"onUpdate:modelValue":l[8]||(l[8]=e=>W.value.desc=e),placeholder:"请输入详细描述...",maxlength:"500","auto-height":!0},null,8,["modelValue"])])),_:1}),d(h,{class:"popup-actions"},{default:u((()=>[d(j,{class:"cancel-btn",onClick:ul},{default:u((()=>[r("取消")])),_:1}),d(j,{class:"confirm-btn",onClick:cl,disabled:!xe.value},{default:u((()=>[r("确认修改")])),_:1},8,["disabled"])])),_:1})])),_:1},8,["class"])])),_:1})):c("",!0),Z.value?(i(),s(h,{key:3,class:"date-modal-overlay",onClick:Ke},{default:u((()=>[d(h,{class:"date-modal-content",onClick:l[10]||(l[10]=y((()=>{}),["stop"]))},{default:u((()=>[d(h,{class:"date-header"},{default:u((()=>[d(g,{class:"date-title"},{default:u((()=>[r("选择截止日期")])),_:1}),d(h,{class:"date-close",onClick:Ke},{default:u((()=>[d(n,{type:"close",size:"20",color:"#666"})])),_:1})])),_:1}),d(h,{class:"date-picker-wheel"},{default:u((()=>[d(Y,{value:ue.value,onChange:qe,class:"picker-view","indicator-style":"height: 68rpx; border-top: 1rpx solid #e0e0e0; border-bottom: 1rpx solid #e0e0e0;","mask-style":"background-image: linear-gradient(180deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.6)), linear-gradient(0deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.6));"},{default:u((()=>[d(H,null,{default:u((()=>[(i(!0),v(f,null,p(ne.value,((e,l)=>(i(),s(h,{key:l,class:"picker-item"},{default:u((()=>[d(g,{class:"picker-text"},{default:u((()=>[r(_(e)+"年",1)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),d(H,null,{default:u((()=>[(i(!0),v(f,null,p(oe.value,((e,l)=>(i(),s(h,{key:l,class:"picker-item"},{default:u((()=>[d(g,{class:"picker-text"},{default:u((()=>[r(_(e)+"月",1)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),d(H,null,{default:u((()=>[(i(!0),v(f,null,p(ie.value,((e,l)=>(i(),s(h,{key:l,class:"picker-item"},{default:u((()=>[d(g,{class:"picker-text"},{default:u((()=>[r(_(e)+"日",1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1},8,["value"])])),_:1}),ee.value?(i(),s(h,{key:0,class:"selected-info"},{default:u((()=>[d(g,null,{default:u((()=>[r("选中的日期: "+_(Ne(ee.value)),1)])),_:1})])),_:1})):c("",!0),d(h,{class:"date-actions"},{default:u((()=>[d(j,{class:"date-cancel-btn",onClick:Ke},{default:u((()=>[r("取消")])),_:1}),d(j,{class:"date-confirm-btn",onClick:We,disabled:!ee.value},{default:u((()=>[r("确认")])),_:1},8,["disabled"])])),_:1})])),_:1})])),_:1})):c("",!0)])),_:1})}}},[["__scopeId","data-v-c62d0e1f"]]);export{A as default};

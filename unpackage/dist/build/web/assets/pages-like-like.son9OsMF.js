import{r as e,p as a,o as l,a as t,c as s,w as o,s as r,i as n,b as c,g as u,d as i,e as d,u as v,v as f,F as p,J as k,j as h,k as m,S as y,x as _,n as g,t as w,C,y as b,z as x}from"./index-DwnOT4K7.js";import{r as j,_ as X}from"./uni-app.es.BBfL1HZQ.js";import{_ as z}from"./uni-card.BTl7MJ-D.js";import{t as D}from"./taskApi.A__h-ifa.js";import{u as T}from"./user.H6OceLeH.js";import{_ as F}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./request.DtiC9qg0.js";const I=F({__name:"like",setup(F){const I=T(),S=e([]),q=e(!1),M=e(!1),R=e(1),E=e(10),L=e(!0),Y=e(!1),$=e(0),A=e({}),J=e(0),N=e(0),O=e(null),U=e(!1),B=e(!1),G=a((()=>I.userInfo.backgroudImg||"")),H=()=>{k({delta:1})},K=e=>{A.value[e]&&(A.value[e].translateX=0,A.value[e].showDelete=!1)},P=()=>{Object.keys(A.value).forEach((e=>{K(e)}))},Q=()=>{P()},V=e=>{P();const a=Z(e);a?C({title:"取消收藏",content:`确定要取消收藏"${a.taskDescription}"吗？`,confirmColor:"#f56c6c",success:async a=>{a.confirm&&await W(e)}}):console.error("未找到要取消收藏的任务:",e)},W=async e=>{if(e){b({title:"取消收藏中..."});try{const a=await D.like(e);x(),200===a.code||"200"===a.code?(r({title:"已取消收藏",icon:"success"}),await le()):r({title:a.message||"取消收藏失败",icon:"none"})}catch(a){x(),r({title:"取消收藏失败",icon:"none"}),console.error("取消收藏失败:",a)}}},Z=e=>S.value.find((a=>a.id===e)),ee=()=>{M.value=!0,r({title:"背景图片加载失败",icon:"none"})},ae=()=>{M.value=!1},le=async(e=!0)=>{e?(q.value=!0,R.value=1,S.value=[]):Y.value=!0;try{const a=await D.queryLike({pageNo:R.value,pageSize:E.value});if(a&&"200"===a.code&&a.data){const l=a.data,t=l.list||[];S.value=e?t:[...S.value,...t],$.value=l.total||0,L.value=R.value<(l.pages||1)}}catch(a){console.error("获取收藏列表失败:",a),r({title:"获取收藏列表失败",icon:"none"})}finally{e?q.value=!1:Y.value=!1}},te=e=>{},se=async()=>{B.value=!0,U.value=!0;try{await le(!0),r({title:"刷新成功",icon:"success",duration:1500})}catch(e){console.error("刷新失败:",e),r({title:"刷新失败，请重试",icon:"none",duration:2e3})}finally{setTimeout((()=>{B.value=!1,U.value=!1}),800)}},oe=()=>{B.value=!1,U.value=!1},re=async()=>{L.value&&!Y.value&&(R.value++,await le(!1))},ne=()=>{L.value&&!Y.value&&re()};return l((()=>{I.initUserInfo(),le(!0)})),(e,a)=>{const l=h,k=j(t("uni-icons"),X),C=n,b=m,x=j(t("uni-card"),z),T=y;return c(),s(C,{class:"like-container"},{default:o((()=>[G.value?(c(),s(l,{key:0,src:G.value,class:"background-image",mode:"aspectFill",onError:ee,onLoad:ae},null,8,["src"])):u("",!0),i(C,{class:"nav-header"},{default:o((()=>[i(C,{class:"nav-left"},{default:o((()=>[i(k,{type:"back",size:"24",color:"#fff",onClick:H})])),_:1}),i(C,{class:"nav-center"},{default:o((()=>[i(b,{class:"nav-title"},{default:o((()=>[d("收藏")])),_:1})])),_:1}),i(C,{class:"nav-right"})])),_:1}),i(T,{class:"task-list","scroll-y":"true",onScroll:Q,onScrolltolower:ne,"refresher-enabled":"true","refresher-background":"transparent","refresher-triggered":B.value,onRefresherpulling:te,onRefresherrefresh:se,onRefresherrestore:oe},{default:o((()=>[0!==S.value.length||q.value?u("",!0):(c(),s(C,{key:0,class:"empty-state"},{default:o((()=>[i(k,{type:"star",size:"80",color:"rgba(255, 255, 255, 0.3)"}),i(b,{class:"empty-text"},{default:o((()=>[d("暂无收藏任务")])),_:1})])),_:1})),(c(!0),v(p,null,f(S.value,((e,a)=>(c(),s(x,{key:e.id,"is-shadow":!1,border:!1,margin:"8rpx 20rpx",class:"task-card task-swipe-container"},{default:o((()=>[i(C,{class:"task-swipe-wrapper"},{default:o((()=>{var a,l;return[i(C,{class:"task-item",style:_({transform:`translateX(${(null==(a=A.value[e.id])?void 0:a.translateX)||0}rpx)`}),onTouchstart:a=>{return l=a,t=e.id,J.value=l.touches[0].clientX,N.value=l.touches[0].clientY,void(O.value=t);var l,t},onTouchmove:a=>((e,a)=>{if(O.value!==a)return;const l=e.touches[0].clientX,t=e.touches[0].clientY,s=l-J.value,o=t-N.value;if(!(Math.abs(o)>Math.abs(s))&&s<0){const e=Math.max(.5*s,-120);A.value[a]||(A.value[a]={}),A.value[a].translateX=e,A.value[a].showDelete=e<-30}})(a,e.id),onTouchend:a=>((e,a)=>{if(O.value!==a)return;const l=A.value[a];l&&(l.translateX<-60?V(a):l.translateX<-30?(l.translateX=-120,l.showDelete=!0):K(a),O.value=null)})(0,e.id)},{default:o((()=>[i(C,{class:"task-checkbox"},{default:o((()=>[i(k,{type:"checkbox",size:24,color:e.isCompleted?"#4CD964":"#C7C7CC"},null,8,["color"])])),_:2},1024),i(C,{class:"task-content"},{default:o((()=>[i(b,{class:g(["task-description",{completed:e.isCompleted}])},{default:o((()=>[d(w(e.taskDescription),1)])),_:2},1032,["class"]),e.value&&e.value>=1?(c(),s(C,{key:0,class:"task-value"},{default:o((()=>[i(k,{type:"wallet",size:"14",color:"#666"}),i(b,{class:"value-text"},{default:o((()=>[d(w(e.value),1)])),_:2},1024)])),_:2},1024)):u("",!0)])),_:2},1024),i(C,{class:"task-actions"},{default:o((()=>[i(k,{type:"star-filled",size:24,color:"#FFD700",onClick:a=>(async e=>{try{const a=await D.like(e);200===a.code||"200"===a.code?await le():r({title:a.message||"操作失败",icon:"none"})}catch(a){console.error("切换收藏状态失败:",a),r({title:"操作失败",icon:"none"})}})(e.id)},null,8,["onClick"])])),_:2},1024)])),_:2},1032,["style","onTouchstart","onTouchmove","onTouchend"]),(null==(l=A.value[e.id])?void 0:l.showDelete)?(c(),s(C,{key:0,class:"delete-action",onClick:a=>V(e.id)},{default:o((()=>[i(k,{type:"heart-filled",size:"24",color:"#fff"})])),_:2},1032,["onClick"])):u("",!0)]})),_:2},1024)])),_:2},1024)))),128)),S.value.length>0?(c(),s(C,{key:1,class:"load-more"},{default:o((()=>[Y.value?(c(),s(C,{key:0,class:"loading-text"},{default:o((()=>[i(b,null,{default:o((()=>[d("加载中...")])),_:1})])),_:1})):L.value?(c(),s(C,{key:1,class:"load-more-btn",onClick:re},{default:o((()=>[i(b,null,{default:o((()=>[d("点击加载更多")])),_:1})])),_:1})):(c(),s(C,{key:2,class:"no-more-text"},{default:o((()=>[i(b,null,{default:o((()=>[d("已加载全部数据")])),_:1})])),_:1}))])),_:1})):u("",!0)])),_:1},8,["refresher-triggered"])])),_:1})}}},[["__scopeId","data-v-07134ac7"]]);export{I as default};

import{r as e,p as a,o as s,a as t,c as l,w as u,s as c,i as r,b as o,g as n,d as i,e as d,t as f,u as v,v as _,F as p,J as k,j as y,k as m,K as h,S as g,n as C}from"./index-DwnOT4K7.js";import{r as b,_ as x}from"./uni-app.es.BBfL1HZQ.js";import{_ as w}from"./uni-card.BTl7MJ-D.js";import{t as z}from"./taskApi.A__h-ifa.js";import{u as j}from"./user.H6OceLeH.js";import{_ as D}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./request.DtiC9qg0.js";const F=D({__name:"statistics",setup(D){const F=j(),I=e([]),M=e(!1),$=e(!1),P=new Date,R=e(P.getFullYear()),q=e(P.getMonth()+1),S=e([]),Y=e(0),A=e(["1","2","3","4","5","6","7","8","9","10","11","12"]),E=e(P.getMonth()),J=e({}),K=e({}),L=e(!1),T=e(!1),U=a((()=>F.userInfo.backgroudImg||"")),B=()=>{k({delta:1})},G=e=>`${e.year}-${e.month}-${e.day}`,H=async e=>{const a=e.detail.value;Y.value=a,R.value=parseInt(S.value[a]),await W()},N=async e=>{const a=e.detail.value;E.value=a,q.value=parseInt(A.value[a]),await W()},O=e=>e?e.filter((e=>e.isCompleted)):[],Q=()=>{L.value=!L.value,I.value=V(I.value)},V=e=>e.sort(((e,a)=>L.value?a.day-e.day:e.day-a.day)),W=async()=>{M.value=!0;try{const e=await z.statistic({year:R.value,month:q.value});e&&"200"===e.code&&e.data&&(I.value=V(e.data))}catch(e){console.error("获取统计数据失败:",e),c({title:"获取统计数据失败",icon:"none"})}finally{M.value=!1}},X=()=>{$.value=!0},Z=()=>{$.value=!1},ee=e=>{},ae=async()=>{T.value=!0;try{await W(),c({title:"刷新成功",icon:"success",duration:1500})}catch(e){console.error("刷新失败:",e),c({title:"刷新失败，请重试",icon:"none",duration:2e3})}finally{setTimeout((()=>{T.value=!1}),800)}},se=()=>{T.value=!1};return s((()=>{F.initUserInfo(),(()=>{const e=(new Date).getFullYear(),a=[];for(let t=e-2;t<=e+1;t++)a.push(t.toString());S.value=a;const s=a.findIndex((e=>parseInt(e)===R.value));Y.value=s>=0?s:a.length-2})(),W()})),(e,a)=>{const s=y,c=b(t("uni-icons"),x),k=r,z=m,j=h,D=b(t("uni-card"),w),F=g;return o(),l(k,{class:"statistics-container"},{default:u((()=>[U.value?(o(),l(s,{key:0,src:U.value,class:"background-image",mode:"aspectFill",onError:X,onLoad:Z},null,8,["src"])):n("",!0),i(k,{class:"nav-header"},{default:u((()=>[i(k,{class:"nav-left"},{default:u((()=>[i(c,{type:"back",size:"24",color:"#fff",onClick:B})])),_:1}),i(k,{class:"nav-center"},{default:u((()=>[i(z,{class:"nav-title"},{default:u((()=>[d("统计")])),_:1})])),_:1}),i(k,{class:"nav-right"})])),_:1}),i(k,{class:"date-selector"},{default:u((()=>[i(k,{class:"selector-left"},{default:u((()=>[i(k,{class:"selector-item"},{default:u((()=>[i(z,{class:"selector-label"},{default:u((()=>[d("年份")])),_:1}),i(j,{mode:"selector",value:Y.value,range:S.value,onChange:H},{default:u((()=>[i(k,{class:"picker-value"},{default:u((()=>[d(f(R.value)+"年",1)])),_:1})])),_:1},8,["value","range"])])),_:1}),i(k,{class:"selector-item"},{default:u((()=>[i(z,{class:"selector-label"},{default:u((()=>[d("月份")])),_:1}),i(j,{mode:"selector",value:E.value,range:A.value,onChange:N},{default:u((()=>[i(k,{class:"picker-value"},{default:u((()=>[d(f(q.value)+"月",1)])),_:1})])),_:1},8,["value","range"])])),_:1})])),_:1}),i(k,{class:"selector-right"},{default:u((()=>[i(k,{class:"sort-btn",onClick:Q},{default:u((()=>[i(c,{type:L.value?"up":"down",size:"20",color:"#fff"},null,8,["type"]),i(z,{class:"sort-text"},{default:u((()=>[d(f(L.value?"倒序":"正序"),1)])),_:1})])),_:1})])),_:1})])),_:1}),i(F,{class:"statistics-list","scroll-y":"true","refresher-enabled":"true","refresher-background":"transparent","refresher-triggered":T.value,onRefresherpulling:ee,onRefresherrefresh:ae,onRefresherrestore:se},{default:u((()=>[0!==I.value.length||M.value?n("",!0):(o(),l(k,{key:0,class:"empty-state"},{default:u((()=>[i(c,{type:"bars",size:"80",color:"rgba(255, 255, 255, 0.3)"}),i(z,{class:"empty-text"},{default:u((()=>[d("暂无统计数据")])),_:1})])),_:1})),(o(!0),v(p,null,_(I.value,((e,a)=>(o(),l(D,{key:`${e.year}-${e.month}-${e.day}`,"is-shadow":!1,border:!1,margin:"8rpx 20rpx",class:C(["statistic-card",{disabled:!e.isPast}])},{default:u((()=>[i(k,{class:C(["statistic-item",{disabled:!e.isPast}]),onClick:a=>(e=>{if(!e.isPast)return;const a=G(e);J.value[a]=!J.value[a],J.value[a]&&(K.value[a]=!0)})(e)},{default:u((()=>[i(k,{class:"statistic-header"},{default:u((()=>[i(k,{class:"date-info"},{default:u((()=>[i(z,{class:"date-text"},{default:u((()=>[d(f(e.month)+"/"+f(e.day),1)])),_:2},1024),i(z,{class:"weekday-text"},{default:u((()=>{return[d(f((a=e.year,s=e.month,t=e.day,["周日","周一","周二","周三","周四","周五","周六"][new Date(a,s-1,t).getDay()])),1)];var a,s,t})),_:2},1024)])),_:2},1024),i(k,{class:"stats-info"},{default:u((()=>[i(k,{class:"stat-item"},{default:u((()=>[i(z,{class:"stat-label"},{default:u((()=>[d("完成")])),_:1}),i(z,{class:"stat-value finish"},{default:u((()=>[d(f(e.finishCount||0),1)])),_:2},1024)])),_:2},1024),i(k,{class:"stat-item"},{default:u((()=>[i(z,{class:"stat-label"},{default:u((()=>[d("未完成")])),_:1}),i(z,{class:"stat-value left"},{default:u((()=>[d(f(e.leftCount||0),1)])),_:2},1024)])),_:2},1024),i(k,{class:"stat-item"},{default:u((()=>[i(z,{class:"stat-label"},{default:u((()=>[d("收入")])),_:1}),i(z,{class:"stat-value income"},{default:u((()=>[d("+"+f(e.addMoney||0),1)])),_:2},1024)])),_:2},1024),e.difMoney&&e.difMoney>0?(o(),l(k,{key:0,class:"stat-item"},{default:u((()=>[i(z,{class:"stat-label"},{default:u((()=>[d("惩罚")])),_:1}),i(z,{class:"stat-value expense"},{default:u((()=>[d("-"+f(e.difMoney),1)])),_:2},1024)])),_:2},1024)):n("",!0)])),_:2},1024),e.isPast?(o(),l(k,{key:0,class:"expand-icon"},{default:u((()=>[i(c,{type:J.value[G(e)]?"down":"right",size:"16",color:"rgba(255, 255, 255, 0.7)"},null,8,["type"])])),_:2},1024)):n("",!0)])),_:2},1024),J.value[G(e)]&&e.tasks&&e.tasks.length>0?(o(),l(k,{key:0,class:C(["tasks-container",{expanded:J.value[G(e)]}])},{default:u((()=>[i(k,{class:"tasks-divider"}),i(k,{class:"task-section"},{default:u((()=>{return[(o(!0),v(p,null,_((a=e.tasks,a?a.filter((e=>!e.isCompleted)):[]),((e,a)=>(o(),l(k,{key:e.id,class:"task-item"},{default:u((()=>[i(k,{class:"task-checkbox"},{default:u((()=>[i(c,{type:"checkbox",size:20,color:"#C7C7CC"})])),_:1}),i(k,{class:"task-content"},{default:u((()=>[i(z,{class:"task-description"},{default:u((()=>[d(f(e.taskDescription),1)])),_:2},1024),e.value&&e.value>=1?(o(),l(k,{key:0,class:"task-value"},{default:u((()=>[i(c,{type:"wallet",size:"12",color:"#666"}),i(z,{class:"value-text"},{default:u((()=>[d(f(e.value),1)])),_:2},1024)])),_:2},1024)):n("",!0)])),_:2},1024),i(k,{class:"task-actions"},{default:u((()=>[i(c,{type:e.like?"star-filled":"star",size:20,color:e.like?"#FFD700":"#C7C7CC"},null,8,["type","color"])])),_:2},1024)])),_:2},1024)))),128))];var a})),_:2},1024),O(e.tasks).length>0?(o(),l(k,{key:0,class:"section-title",onClick:a=>(e=>{const a=G(e);K.value[a]=!K.value[a]})(e)},{default:u((()=>[i(c,{type:K.value[G(e)]?"down":"right",size:"16",color:"rgba(51, 51, 51, 0.7)"},null,8,["type"]),i(z,{class:"section-text"},{default:u((()=>[d("已完成")])),_:1})])),_:2},1032,["onClick"])):n("",!0),i(k,{class:C(["completed-tasks-container",{collapsed:!K.value[G(e)]}])},{default:u((()=>[(o(!0),v(p,null,_(O(e.tasks),((e,a)=>(o(),l(k,{key:e.id,class:"task-item"},{default:u((()=>[i(k,{class:"task-checkbox"},{default:u((()=>[i(c,{type:"checkbox",size:20,color:"#4CD964"})])),_:1}),i(k,{class:"task-content"},{default:u((()=>[i(z,{class:"task-description completed"},{default:u((()=>[d(f(e.taskDescription),1)])),_:2},1024),e.value&&e.value>=1?(o(),l(k,{key:0,class:"task-value"},{default:u((()=>[i(c,{type:"wallet",size:"12",color:"#666"}),i(z,{class:"value-text"},{default:u((()=>[d(f(e.value),1)])),_:2},1024)])),_:2},1024)):n("",!0)])),_:2},1024),i(k,{class:"task-actions"},{default:u((()=>[i(c,{type:e.like?"star-filled":"star",size:20,color:e.like?"#FFD700":"#C7C7CC"},null,8,["type","color"])])),_:2},1024)])),_:2},1024)))),128))])),_:2},1032,["class"])])),_:2},1032,["class"])):n("",!0)])),_:2},1032,["onClick","class"])])),_:2},1032,["class"])))),128))])),_:1},8,["refresher-triggered"])])),_:1})}}},[["__scopeId","data-v-7c78c413"]]);export{F as default};

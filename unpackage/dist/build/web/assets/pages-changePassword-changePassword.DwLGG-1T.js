import{r as e,p as l,q as a,a as t,c as s,w as u,i as n,b as o,d,e as r,n as c,t as v,s as i,h as p,k as f,I as _,l as h}from"./index-DwnOT4K7.js";import{r as g,_ as m}from"./uni-app.es.BBfL1HZQ.js";import{u as w}from"./userApi.CtVFmYfA.js";import{_ as b}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./request.DtiC9qg0.js";const x=b({__name:"changePassword",setup(b){const x=e(""),y=e(""),$=e(""),k=e(""),z=e(!1),V=e(!1),A=e(0),Z=e(null),I=e(""),j=e(""),C=e(""),B=e(""),U=()=>{z.value=!z.value},D=()=>{V.value=!V.value},P=e=>{let l=e.detail.value;l=l.replace(/\D/g,""),l.length>11&&(l=l.slice(0,11)),x.value=l,I.value&&(I.value="")},q=e=>{let l=e.detail.value;l=l.replace(/\D/g,""),l.length>6&&(l=l.slice(0,6)),y.value=l,j.value&&(j.value="")},O=e=>{let l=e.detail.value;l=l.replace(/[^a-zA-Z0-9_]/g,""),$.value=l,C.value&&(C.value=""),k.value&&B.value&&H()},T=e=>{let l=e.detail.value;l=l.replace(/[^a-zA-Z0-9_]/g,""),k.value=l,B.value&&(B.value="")},E=()=>{x.value?/^1[3-9]\d{9}$/.test(x.value)?I.value="":I.value="手机号格式为1开头的11位数字":I.value=""},F=()=>{y.value?/^\d{6}$/.test(y.value)?j.value="":j.value="验证码格式为6位数字":j.value=""},G=()=>{$.value?$.value.length<8?C.value="密码格式为至少8位字符":/^[a-zA-Z0-9_]+$/.test($.value)?C.value="":C.value="密码格式只能包含字母数字和下划线":C.value=""},H=()=>{k.value&&k.value!==$.value?B.value="确认密码格式需与新密码一致":B.value=""},J=l((()=>/^1[3-9]\d{9}$/.test(x.value)&&0===A.value)),K=l((()=>A.value>0?`${A.value}秒`:"发送验证码")),L=l((()=>/^1[3-9]\d{9}$/.test(x.value)&&/^\d{6}$/.test(y.value)&&$.value.length>=8&&/^[a-zA-Z0-9_]+$/.test($.value)&&k.value===$.value)),M=()=>{const e=$.value;return/^[a-zA-Z0-9_]*$/.test(e)?e.length<8?0:e.length<=10&&(/^[a-zA-Z]+$/.test(e)||/^\d+$/.test(e))?1:/[a-zA-Z]/.test(e)&&/\d/.test(e)&&/_/.test(e)?3:/[a-zA-Z]/.test(e)&&/\d/.test(e)?2:1:0},N=()=>{const e=M(),l=$.value;if(!/^[a-zA-Z0-9_]*$/.test(l))return"密码只能包含字母数字和下划线";if(l.length<8)return"密码至少8位";return["密码格式错误","密码强度：弱","密码强度：中","密码强度：强"][e]},Q=async()=>{J.value&&(/^1[3-9]\d{9}$/.test(x.value)?(console.log("发送验证码到：",x.value),await w.updPasswordCode(x.value),i({title:"验证码已发送",icon:"success"}),A.value=60,Z.value=setInterval((()=>{A.value--,A.value<=0&&(clearInterval(Z.value),Z.value=null)}),1e3)):i({title:"请输入正确的手机号格式",icon:"none"}))},R=async()=>{if(!L.value)return;if(!/^1[3-9]\d{9}$/.test(x.value))return void i({title:"请输入正确的手机号格式",icon:"none"});if(!/^\d{6}$/.test(y.value))return void i({title:"验证码必须是6位数字",icon:"none"});if($.value.length<8)return void i({title:"密码至少需要8位",icon:"none"});if(!/^[a-zA-Z0-9_]+$/.test($.value))return void i({title:"密码只能包含字母数字和下划线",icon:"none"});if($.value!==k.value)return void i({title:"两次密码输入不一致",icon:"none"});const e=await w.updatePassword({phone:x.value,password:$.value,code:y.value});console.log("修改密码结果:",e),200===e.code||"200"===e.code?(i({title:"密码修改成功",icon:"success"}),p({url:"/pages/index/index"})):i({title:e.msg,icon:"none"}),setTimeout((()=>{S()}),1500)},S=()=>{p({url:"/pages/index/index"})};return a((()=>{Z.value&&clearInterval(Z.value)})),(e,l)=>{const a=f,i=n,p=_,w=h,b=g(t("uni-icons"),m);return o(),s(i,{class:"change-password-container"},{default:u((()=>[d(i,{class:"change-password-card"},{default:u((()=>[d(i,{class:"header"},{default:u((()=>[d(i,{class:"logo"},{default:u((()=>[d(a,{class:"logo-text"},{default:u((()=>[r("TODO+")])),_:1})])),_:1}),d(a,{class:"subtitle"},{default:u((()=>[r("重置您的密码")])),_:1})])),_:1}),d(i,{class:"form-container"},{default:u((()=>[d(i,{class:"input-group"},{default:u((()=>[d(i,{class:"input-label"},{default:u((()=>[d(a,{class:"label-text"},{default:u((()=>[r("手机号")])),_:1})])),_:1}),d(i,{class:"input-wrapper"},{default:u((()=>[d(p,{class:"input-field",type:"number",modelValue:x.value,"onUpdate:modelValue":l[0]||(l[0]=e=>x.value=e),placeholder:"请输入手机号","placeholder-class":"placeholder-style",maxlength:"11",onInput:P,onBlur:E},null,8,["modelValue"])])),_:1}),d(i,{class:c(["error-tip",{show:I.value}])},{default:u((()=>[d(a,{class:"error-text"},{default:u((()=>[r(v(I.value),1)])),_:1})])),_:1},8,["class"])])),_:1}),d(i,{class:"input-group"},{default:u((()=>[d(i,{class:"input-label"},{default:u((()=>[d(a,{class:"label-text"},{default:u((()=>[r("验证码")])),_:1})])),_:1}),d(i,{class:"input-wrapper verification-wrapper"},{default:u((()=>[d(p,{class:"input-field verification-input",type:"number",modelValue:y.value,"onUpdate:modelValue":l[1]||(l[1]=e=>y.value=e),placeholder:"请输入验证码","placeholder-class":"placeholder-style",maxlength:"6",onInput:q,onBlur:F},null,8,["modelValue"]),d(w,{class:c(["send-code-btn",{"btn-disabled":!J.value}]),disabled:!J.value,onClick:Q},{default:u((()=>[r(v(K.value),1)])),_:1},8,["class","disabled"])])),_:1}),d(i,{class:c(["error-tip",{show:j.value}])},{default:u((()=>[d(a,{class:"error-text"},{default:u((()=>[r(v(j.value),1)])),_:1})])),_:1},8,["class"])])),_:1}),d(i,{class:"input-group"},{default:u((()=>[d(i,{class:"input-label"},{default:u((()=>[d(a,{class:"label-text"},{default:u((()=>[r("新密码")])),_:1})])),_:1}),d(i,{class:"input-wrapper"},{default:u((()=>[d(p,{class:"input-field",type:z.value?"text":"password",modelValue:$.value,"onUpdate:modelValue":l[2]||(l[2]=e=>$.value=e),placeholder:"请输入新密码","placeholder-class":"placeholder-style",onInput:O,onBlur:G},null,8,["type","modelValue"]),d(i,{class:"eye-icon",onClick:U},{default:u((()=>[d(b,{type:z.value?"eye":"eye-slash",size:"20",color:"#999"},null,8,["type"])])),_:1})])),_:1}),d(i,{class:c(["error-tip",{show:C.value}])},{default:u((()=>[d(a,{class:"error-text"},{default:u((()=>[r(v(C.value),1)])),_:1})])),_:1},8,["class"]),d(i,{class:c(["password-strength",{show:$.value}])},{default:u((()=>[d(a,{class:c(["strength-text",["strength-weak","strength-weak","strength-medium","strength-strong"][M()]])},{default:u((()=>[r(v(N()),1)])),_:1},8,["class"])])),_:1},8,["class"])])),_:1}),d(i,{class:"input-group"},{default:u((()=>[d(i,{class:"input-label"},{default:u((()=>[d(a,{class:"label-text"},{default:u((()=>[r("确认新密码")])),_:1})])),_:1}),d(i,{class:"input-wrapper"},{default:u((()=>[d(p,{class:"input-field",type:V.value?"text":"password",modelValue:k.value,"onUpdate:modelValue":l[3]||(l[3]=e=>k.value=e),placeholder:"请再次输入新密码","placeholder-class":"placeholder-style",onInput:T,onBlur:H},null,8,["type","modelValue"]),d(i,{class:"eye-icon",onClick:D},{default:u((()=>[d(b,{type:V.value?"eye":"eye-slash",size:"20",color:"#999"},null,8,["type"])])),_:1})])),_:1}),d(i,{class:c(["error-tip",{show:B.value}])},{default:u((()=>[d(a,{class:"error-text"},{default:u((()=>[r(v(B.value),1)])),_:1})])),_:1},8,["class"])])),_:1}),d(i,{class:"button-group"},{default:u((()=>[d(w,{class:c(["change-password-btn",{"btn-disabled":!L.value}]),disabled:!L.value,onClick:R},{default:u((()=>[r(" 确认修改 ")])),_:1},8,["class","disabled"])])),_:1}),d(i,{class:"footer-links"},{default:u((()=>[d(a,{class:"link-text"},{default:u((()=>[r("记起密码了？")])),_:1}),d(a,{class:"link-btn",onClick:S},{default:u((()=>[r("立即登录")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-c95e24ff"]]);export{x as default};
